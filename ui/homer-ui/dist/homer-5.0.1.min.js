(function(a){(a.homer=a.homer||{}).modules={app:{name:"homerApp"}}})(window);function isUndefined(a){return"undefined"==typeof a}function defineHomerAngularModule(a,b){return angular.module(a,b)}function defineHomerJsLibrary(a,b,d){if(isUndefined(d)&&(d=b,b=[],d instanceof Array))for(var c=0;c<d.length-1;++c)b.push(d[c]);return angular.module(a,b).factory(a,d)}$.tmpl=function(a,b){do{var d=a;a=a.replace(/#{([^}]+)}/g,function(a,d){var h=b[$.trim(d)];return void 0===h?a:h});d=a!==d}while(d);return a};
function defineExportTemplate(){return"HOMER5-#{destination_ip}-#{ruri_user}-#{date}"};(function(a,b){b.modules.core={name:"homer-core",services:{eventbus:"eventbus",search:"search",profile:"userProfile",store:"storeService"}};a.module(b.modules.core.name,["ui.router"])})(angular,homer);(function(a,b){a.module(b.modules.core.name).factory(b.modules.core.services.profile,["$q","$http","eventbus","$log",function(d,b,e,h){var k=!1,g={},f={timerange:{from:new Date((new Date).getTime()-9E5),to:new Date},search:{},transaction:{},result:{},node:{},limit:200};g.result=f.result;g.node=f.node;g.transaction=f.transaction;g.limit=f.limit;g.timerange=f.timerange;g.search=f.search;var l=function(a){return a.lastName+a.firstName},m=function(a){delete g[a]},n=function(a,f){var l="api/v1/profile/store";
null!=a&&(l="api/v1/profile/store/"+a);var m={id:a,param:f},u=d.defer();b.post(l,m,{handleStatus:[403,503]}).then(function(a){u.resolve(a.data)},function(a){u.reject()});return u.promise},p=function(a,f){var l=d.defer();b["delete"]("api/v1/profile/store/"+a,{handleStatus:[403,503]}).then(function(a){l.resolve(a.data)},function(a){l.reject()});return l.promise},u=function(){var a=d.defer();b["delete"]("api/v1/profile/store/",{handleStatus:[403,503]}).then(function(d){a.resolve(d.data)},function(d){a.reject()});
return a.promise};return{setProfile:function(a,d){g[a]=d;n(a,d)},getProfile:function(a){return g[a]},deleteProfile:function(a){m(a);p(a)},setLocalProfile:function(a,d){g[a]=d},getLocalProfile:function(a){return g[a]},deleteLocalProfile:m,deleteAllProfile:function(){u()},getRemoteProfile:function(a){var m=d.defer();b.get("api/v1/profile/store/"+a,{handleStatus:[403,503]}).success(function(a){var d=JSON.parse(value);"timerange"==l&&(d.from=new Date(d.from),d.to=new Date(d.to),f.timerange=d);g[l]=d;
f[l]=d;m.resolve(a.data)}).error(function(){m.reject()});return m.promise},setRemoteProfile:n,deleteRemoteProfile:p,getAll:function(){var l=d.defer();if(1==k)return l.resolve(k),l.promise;b.get("api/v1/profile/store",{handleStatus:[403,503]}).success(function(d){a.forEach(d.data,function(d,b){var c=a.fromJson(d);"timerange"==b&&(c.from=new Date(c.from),c.to=new Date(c.to),f.timerange=c);g[b]=c;f[b]=c;k=!0;l.resolve(b)})}).error(function(a){l.reject("Error: request returned status "+a)});return l.promise},
profileScope:f}}])})(angular,homer);(function(a,b){a.module(b.modules.core.name).factory(b.modules.core.services.eventbus,["$rootScope",function(a){return{subscribe:function(b,e){return a.$on(b,e)},broadcast:function(b,e){a.$emit(b,e)}}}])})(angular,homer);(function(a,b){a.module(b.modules.core.name).factory(b.modules.core.services.search,["$q","$http","eventbus",function(a,b,e){var h={},k={fromdate:new Date((new Date).getTime()-3E5),todate:new Date},g={timestamp:{from:new Date((new Date).getTime()-3E5),to:new Date},param:{transaction:{call:!0,registration:!0,rest:!0},limit:200}};return{searchByMethod:function(f){var l=a.defer();b.post("api/v1/search/data",f,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?l.reject("user not authorized"):
l.resolve(a.data.data)},function(a){l.reject("bad response combination")});return l.promise},searchMethod:function(f){var l=a.defer();b.post("api/v1/search/method",f,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?l.reject("user not authorized"):l.resolve(a.data.data)},function(a){l.reject("bad response combination")});return l.promise},searchMessage:function(f){var l=a.defer();b.post("api/v1/search/message",f,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?l.reject("user not authorized"):
l.resolve(a.data.data)},function(a){l.reject("bad response combination")});return l.promise},searchTransaction:function(f){var l=a.defer();b.post("api/v1/search/transaction",f,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?l.reject("user not authorized"):l.resolve(a.data.data)},function(a){l.reject("bad response combination")});return l.promise},makePcapTextforTransaction:function(f,l){var m=a.defer(),e="api/v1/search/export/";b.post(1==l?e+"text":e+"pcap",f,{responseType:"arraybuffer",
handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?m.reject("user not authorized"):m.resolve(a.data)},function(a){m.reject("bad response combination")});return m.promise},makePcapTextData:function(f,l){var m=a.defer(),e="api/v1/search/export/data/";b.post(1==l?e+"text":e+"pcap",f,{responseType:"arraybuffer",handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?m.reject("user not authorized"):m.resolve(a.data)},function(a){m.reject("bad response combination")});return m.promise},
createShareLink:function(f){var l=a.defer();b.post("api/v1/search/sharelink",f,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?l.reject("user not authorized"):l.resolve(a.data.data)},function(a){l.reject("bad response combination")});return l.promise},getTimeRange:function(){return k},setTimeRange:function(a){k=a},getSearchData:function(){return g},setSearchData:function(a){g=a},getSearchValue:function(){return h},setSearchValue:function(a){h=a},searchValue:h,searchRTCPReport:function(f){var l=
a.defer();b.post("api/v1/report/rtcp",f,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?l.reject("user not authorized"):l.resolve(a.data.data)},function(a){l.reject("bad response combination")});return l.promise},searchLogReport:function(f){var l=a.defer();b.post("api/v1/report/log",f,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?l.reject("user not authorized"):l.resolve(a.data.data)},function(a){l.reject("bad response combination")});return l.promise},searchQualityReport:function(f,
l){var m=a.defer();b.post("api/v1/report/quality/"+f,l,{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?m.reject("user not authorized"):m.resolve(a.data.data)},function(a){m.reject("bad response combination")});return m.promise},loadNode:function(){var f=a.defer();b.get("api/v1/dashboard/node",{handleStatus:[403,503]}).then(function(a){"false"==a.data.auth?f.reject("user not authorized"):f.resolve(a.data.data)},function(a){f.reject("bad response combination")});return f.promise}}}]).factory("sessionRecoverer",
["$q","eventbus","$rootScope","$location",function(a,c,e,h){return{responseError:function(k){403==k.status&&(e.loggedIn=!1,c.broadcast(b.modules.auth.events.userLoggedOut),h.path(b.modules.auth.routes.login));return a.reject(k)}}}]).config(["$httpProvider",function(a){a.interceptors.push("sessionRecoverer")}])})(angular,homer);(function(a,b){a.module(b.modules.core.name).factory(b.modules.core.services.store,["$q","$http","eventbus",function(a,b,e){return{getAll:function(){var e=a.defer();b.get("api/v1/dashboard/store",{handleStatus:[403,503]}).then(function(a){e.resolve(a.data)},function(a){e.reject()});return e.promise},get:function(e){var k=a.defer();b.get("api/v1/dashboard/store/"+e,{handleStatus:[403,503]}).success(function(a){k.resolve(a.data)}).error(function(){k.reject()});return k.promise},set:function(e,k){var g=
a.defer();b.post("api/v1/dashboard/store/"+e,k,{handleStatus:[403,503]}).then(function(a){g.resolve(a.data)},function(a){g.reject()});return g.promise},"delete":function(e,k){var g=a.defer();b["delete"]("api/v1/dashboard/store/"+e,{handleStatus:[403,503]}).then(function(a){g.resolve(a.data)},function(a){g.reject()});return g.promise},menu:function(e,k){var g=a.defer();b.post("api/v1/dashboard/menu/"+e,k,{handleStatus:[403,503]}).then(function(a){g.resolve(a.data)},function(a){g.reject()});return g.promise}}}])})(angular,
homer);(function(a,b){a.module(b.modules.core.name).directive("compareTo",function(){return{scope:{targetModel:"=compareTo"},require:"ngModel",link:function(a,b,e,h){a.$watch(function(){var e=b.val(),h=a.targetModel;return null!==h?e===h:!1},function(a){h.$setValidity("errorCompareTo",a)})}}}).directive("scroll",function(b){return function(c,e,h){a.element(b).bind("scroll",function(){c.boolChangeClass=50<=this.pageYOffset?!0:!1;c.$apply()})}}).directive("autoHeight",["$window","$timeout",function(b,c){return function(c,
h){var k=a.element(b);c.getWindowDimensions=function(){return{h:k.height(),w:k.width()}};c.$watch(c.getWindowDimensions,function(a,b){c.windowHeight=a.h;c.windowWidth=a.w;c.style=function(){return{height:a.h-100+"px",width:a.w-100+"px"}}},!0);k.bind("resize",function(){c.$apply()})}}])})(angular,homer);(function(a,b){b.modules.structures={name:"structures"};a.module(b.modules.structures.name,["adf"]).config(function(a){a.structure("12",{rows:[{columns:[{styleClass:"col-md-12"}]}]}).structure("6-6",{rows:[{columns:[{styleClass:"col-md-6"},{styleClass:"col-md-6"}]}]}).structure("4-4-4",{rows:[{columns:[{styleClass:"col-md-4"},{styleClass:"col-md-4"},{styleClass:"col-md-4"}]}]}).structure("4-8",{rows:[{columns:[{styleClass:"col-md-4",widgets:[]},{styleClass:"col-md-8",widgets:[]}]}]}).structure("12/4-4-4",
{rows:[{columns:[{styleClass:"col-md-12"}]},{columns:[{styleClass:"col-md-4"},{styleClass:"col-md-4"},{styleClass:"col-md-4"}]}]}).structure("12/6-6",{rows:[{columns:[{styleClass:"col-md-12"}]},{columns:[{styleClass:"col-md-6"},{styleClass:"col-md-6"}]}]}).structure("12/6-6/12",{rows:[{columns:[{styleClass:"col-md-12"}]},{columns:[{styleClass:"col-md-6"},{styleClass:"col-md-6"}]},{columns:[{styleClass:"col-md-12"}]}]})})})(angular,homer);(function(a,b){b.modules.auth={name:"auth",enums:{authorised:{authorised:0,loginRequired:1,notAuthorised:2},permissionCheckType:{atLeastOne:0,combinationRequired:1}},events:{userLoggedIn:"auth:user:loggedIn",usernotAuthorised:"auth:user:notauthorised",userLoggedOut:"auth:user:loggedOut"},controllers:{login:"loginCtrl",logout:"logoutCtrl"},services:{authentication:"authentication",authorization:"authorization"},routes:{login:"/login",logout:"/logout",notAuthorised:"/not-authorised"},state:{login:"login",
logout:"logout",notAuthorised:"notauthorised"}};a.module(b.modules.auth.name,["ui.router",b.modules.core.name])})(angular,homer);(function(a,b){a.module(b.modules.auth.name).config(["$stateProvider","$urlRouterProvider",function(a,c){a.state(b.modules.auth.state.login,{url:b.modules.auth.routes.login,controller:b.modules.auth.controllers.login,templateUrl:"js/modules/auth/html/login.tmpl.html"});a.state(b.modules.auth.state.logout,{url:b.modules.auth.routes.logout,controller:b.modules.auth.controllers.logout,templateUrl:"js/modules/auth/html/logout.tmpl.html"});a.state(b.modules.auth.state.notAuthorised,{url:b.modules.auth.routes.notAuthorised,
controller:b.modules.auth.controllers.login,templateUrl:"js/modules/auth/html/not-authorised.tmpl.html"});c.otherwise(b.modules.pages.routes.home)}])})(angular,homer);(function(a,b){a.module(b.modules.auth.name).factory(b.modules.auth.services.authentication,["$q","$http","eventbus",function(a,c,e){var h,k=function(a,b,d){return{isAuthenticated:b,name:a,permissions:d}};return{login:function(g,f){var l=a.defer();c.post("api/v1/session",{username:g,password:f}).then(function(a){console.log(a.data);if("false"==a.data.auth)l.reject("Unknown Username / Password combination");else{var d=a.data.data.grp.split(",");console.log(d);h=k(g,!0,d);console.log(a.data.data.grp);
e.broadcast(b.modules.auth.events.userLoggedIn,h);l.resolve(h)}},function(a){console.log(a);l.reject("Unknown Username / Password combination")});return l.promise},logout:function(){var g=a.defer();h=void 0;e.broadcast(b.modules.auth.events.userLoggedOut);c["delete"]("api/v1/session").then(function(a){g.resolve(!1)},function(a){g.reject(!1)});return g.promise},session:function(){var g=a.defer();c.get("api/v1/session").then(function(a){if("false"==a.data.auth)h=k("",!1,""),e.broadcast(b.modules.auth.events.usernotAuthorised,
h),g.reject("Unknown Username / Password combination");else{var d=a.data.data.grp.split(",");h=k(a.data.data.username,!0,d);e.broadcast(b.modules.auth.events.userLoggedIn,h);g.resolve(h)}},function(a){g.reject("Unknown Username / Password combination")});return g.promise},user:function(){var g=a.defer();c.get("api/v1/user").then(function(a){if("false"==a.data.auth)console.log("SESSION:"+a.data.auth),g.reject("unknown username");else{var d=a.data.data.user.grp.split(",");h=k(a.data.data.user.username,
!0,d);e.broadcast(b.modules.auth.events.userLoggedIn,h);g.resolve(h)}},function(a){g.reject("Unknown Username")});return g.promise},getCurrentLoginUser:function(){return h}}}])})(angular,homer);(function(a,b){a.module(b.modules.auth.name).factory(b.modules.auth.services.authorization,["authentication",function(d){return{authorize:function(c,e,h){var k=b.modules.auth.enums.authorised.authorised,g=d.getCurrentLoginUser(),f=[],l=!0;h=h||b.modules.auth.enums.permissionCheckType.atLeastOne;if(!0===c&&void 0===g)k=b.modules.auth.enums.authorised.loginRequired;else if(!0===c&&void 0!==g&&(void 0===e||0===e.length))k=b.modules.auth.enums.authorised.authorised;else if(e){f=[];a.forEach(g.permissions,
function(a){f.push(a.toLowerCase())});for(k=0;k<e.length;k+=1)if(c=e[k].toLowerCase(),h===b.modules.auth.enums.permissionCheckType.combinationRequired){if(l=l&&-1<f.indexOf(c),!1===l)break}else if(h===b.modules.auth.enums.permissionCheckType.atLeastOne&&(l=-1<f.indexOf(c)))break;k=l?b.modules.auth.enums.authorised.authorised:b.modules.auth.enums.authorised.notAuthorised}return k}}}])})(angular,homer);(function(a,b){a.module(b.modules.auth.name).controller(b.modules.auth.controllers.login,["$rootScope","$scope","$location","$modal",b.modules.auth.services.authentication,b.modules.core.services.profile,function(a,c,e,h,k,g){c.loginModel={};c.isBusy=!1;c.invalidLogin=!1;a.loggedIn=!1;c.login=function(){console.log("Submiting user info.");c.invalidLogin=!1;c.isBusy=!0;k.login(c.loginModel.username,c.loginModel.password).then(function(f){c.isBusy=!1;1==f.isAuthenticated?(a.loggedIn=!0,console.log(g),
g.getAll(),e.path(b.modules.pages.routes.home)):c.invalidLogin=!0},function(){c.invalidLogin=!0})["finally"](function(){c.isBusy=!1})}}]);a.module(b.modules.auth.name).controller(b.modules.auth.controllers.logout,["$rootScope","$scope","$location",b.modules.auth.services.authentication,function(a,c,e,h){a.loggedIn=!1;h.logout().then(function(a){e.path(b.modules.auth.routes.login)},function(){e.path(b.modules.auth.routes.login)})}])})(angular,homer);(function(a,b){a.module(b.modules.auth.name).directive("access",[b.modules.auth.services.authorization,function(a){return{restrict:"A",link:function(c,e,h){c=h.access.split(",");0<c.length&&(e.removeClass("hidden"),a.authorize(!0,c,h.accessPermissionType)===b.modules.auth.enums.authorised.authorised?e.removeClass("hidden"):e.addClass("hidden"))}}}])})(angular,homer);(function(a,b){b.modules.admin={name:"admin",controllers:{users:"userListCtrl"},routes:{users:"/users"},state:{users:"users"}};defineHomerAngularModule(b.modules.admin.name,["ui.router"])})(angular,homer);(function(a,b){a.module(b.modules.admin.name).config(["$stateProvider","$urlRouterProvider",function(a,c){a.state(b.modules.admin.state.users,{url:b.modules.admin.routes.users,controller:b.modules.admin.controllers.users,templateUrl:"js/modules/admin/html/users.tmpl.html",access:{loginRequired:!0,permissions:["Admin"]}})}])})(angular,homer);(function(a,b){a.module(b.modules.admin.name).controller(b.modules.admin.controllers.users,[function(){}])})(angular,homer);(function(a,b){b.modules.pages={name:"pages",controllers:{"default":"defaultCtrl",search:"searchCtrl",result:"resultCtrl",dashboard:"dashboardCtrl",navigation:"navigationCtrl"},routes:{home:"/dashboard/home",search:"/dashboard/search",alarm:"/dashboard/alarm",result:"/result",dashboard:"/dashboard/:boardID"},events:{dashBoardChanged:"dashboard:item:changed",newDashboardItem:"dashboard:new:item",adfEvent:"adfDashboardChanged",adfDeleteEvent:"adfDashboardRequestedForDelete",widgetsReload:"widgetReload",
resultSearchSubmit:"resultSearchSubmit",hideLeftMenu:"hideLeftMenu",destroyRefresh:"destroyRefresh",setTimeRange:"setTimeRange"},state:{home:"home",search:"search",result:"result",dashboard:"dashboard"}};b.modules.pages.instance=a.module(b.modules.pages.name,["ui.router"])})(angular,homer);(function(a,b){b.modules.pages.instance.config(["$stateProvider",function(a){a.state(b.modules.pages.state.home,{url:b.modules.pages.routes.home,controller:b.modules.pages.controllers.dashboard,controllerAs:"dashboard",templateUrl:"js/modules/pages/html/home.tmpl.html"});a.state(b.modules.pages.state.search,{url:b.modules.pages.routes.search,controller:b.modules.pages.controllers.dashboard,controllerAs:"dashboard",templateUrl:"js/modules/pages/html/search.tmpl.html"});a.state(b.modules.pages.state.result,
{url:b.modules.pages.routes.result,controller:b.modules.pages.controllers.result,templateUrl:"js/modules/pages/html/result.tmpl.html",resolve:{user:function(a,b){return b.getAll()}}});a.state(b.modules.pages.state.dashboard,{url:b.modules.pages.routes.dashboard,controller:b.modules.pages.controllers.dashboard,controllerAs:"dashboard",templateUrl:"js/modules/pages/html/dashboard.tmpl.html"})}])})(angular,homer);(function(a,b){a.module(b.modules.pages.name).controller(b.modules.pages.controllers["default"],["$location","$rootScope",b.modules.auth.services.authentication,function(a,c,e){0==c.loggedIn?(console.log("AUTH FALSE"),a.path(b.modules.auth.routes.login)):console.log("AUTH TRUE")}])})(angular,homer);(function(a,b){a.module(b.modules.pages.name).controller(b.modules.pages.controllers.search,["$scope","$rootScope","eventbus","$http","$location",b.modules.core.services.search,b.modules.core.services.store,function(a,c,e,h,k,g,f){a.expandme=!0;a.showtable=!1;0==c.loggedIn?(console.log("AUTH FALSE"),k.path(b.modules.auth.routes.login)):(console.log("AUTH TRUE"),a.colapseForm=function(){a.expandme=!a.expandme},a.removeForm=function(){a.expandme=!1},a.processSearchForm=function(c){a.showtable=!0;a.expandme=
!1;c=g.getTimeRange();c={timestamp:{from:c.fromdate.getTime(),to:c.todate.getTime()},param:{transaction:{call:!0,registration:!0,rest:!0},limit:100}};g.setSearchData(c);g.setSearchValue(g.searchValue);g.searchValue={};f.setProfile(null,[{name:"timestamp",value:c.timestamp},{name:"param",value:c.param}]).then(function(a){});e.broadcast(b.modules.pages.events.resultSearchSubmit,"fullsearch");k.path("/result")})}])})(angular,homer);(function(a,b){a.module(b.modules.pages.name).controller(b.modules.pages.controllers.result,["$scope","$rootScope","eventbus","$http","$location",b.modules.core.services.search,"$timeout","$window","$homerModal",b.modules.core.services.profile,function(d,c,e,h,k,g,f,l,m,n){d.expandme=!0;d.showtable=!0;d.dataLoading=!1;if(0==c.loggedIn)console.log("AUTH FALSE"),k.path(b.modules.auth.routes.login);else{console.log("AUTH TRUE");e.broadcast(b.modules.pages.events.hideLeftMenu,"1");d.$on("$destroy",function(){e.broadcast(b.modules.pages.events.destroyRefresh,
"1");p()});var p=e.subscribe(b.modules.pages.events.resultSearchSubmit,function(a,b,c){d.processSearchResult()});d.processSearchResult=function(){var c={param:{},timestamp:{}},m=n.getProfile("transaction"),h=n.getProfile("limit"),p=n.getProfile("timerange"),v=n.getProfile("search"),z=n.getProfile("node").dbnode,r={},w=k.search();if(w.hasOwnProperty("query"))for(w=w.query,w=w.substring(1,w.length-2),w=w.split("',"),i=0;i<w.length;i++){var x=w[i].split(":'");r[x[0]]=x[1]}0==Object.keys(r).length?(c.param.transaction=
{},c.param.limit=h,c.param.search=v,c.param.location={},c.param.location.node=z,c.timestamp.from=p.from.getTime(),c.timestamp.to=p.to.getTime(),a.forEach(m.transaction,function(a,b){c.param.transaction[a.name]=!0})):(c.timestamp.from=p.from.getTime(),c.timestamp.to=p.to.getTime(),c.param.transaction={},m={},r.hasOwnProperty("limit")&&(h=r.limit),r.hasOwnProperty("startts")&&(c.timestamp.from=1E3*r.startts),r.hasOwnProperty("endts")&&(c.timestamp.to=1E3*r.endts),r.hasOwnProperty("startdate")&&(v=new Date(r.startdate),
c.timestamp.from=v.getTime()),r.hasOwnProperty("enddate")&&(v=new Date(r.enddate),c.timestamp.to=v.getTime(),console.log(c)),r.hasOwnProperty("trancall")&&(c.param.transaction.call=!0),r.hasOwnProperty("tranreg")&&(c.param.transaction.registration=!0),r.hasOwnProperty("tranrest")&&(c.param.transaction.rest=!0),r.hasOwnProperty("search_callid")&&(m.callid=r.search_callid),r.hasOwnProperty("search_ruri_user")&&(m.ruri_user=r.search_ruri_user),r.hasOwnProperty("search_from_user")&&(m.from_user=r.search_from_user),
r.hasOwnProperty("search_to_user")&&(m.to_user=r.search_to_user),c.param.limit=h,c.param.search=m,c.param.location={},c.param.location.node=z,p.from=new Date(c.timestamp.from),p.to=new Date(c.timestamp.to),n.setProfile("timerange",p),e.broadcast(b.modules.pages.events.setTimeRange,p));d.dataLoading=!0;g.searchByMethod(c).then(function(b){b&&(d.count=b.length,d.gridOpts.data=b,f(function(){a.element(l).resize()},0))},function(a){})["finally"](function(){d.dataLoading=!1})};d.processSearchResult();
d.swapData=function(){};d.hashCode=function(a){for(var b=0,d=0;d<a.length;d++)b=a.charCodeAt(d)+((b<<5)-b);return b};d.intToARGB=function(a){return a>>24&255};d.getBkgColorTable=function(a){a=d.hashCode(a);return{"background-color":"hsl("+d.intToARGB(a)+", 75%, 75%)"}};d.showMessage=function(a,b){var d={timestamp:{from:parseInt(a.entity.micro_ts/1E3),to:parseInt(a.entity.micro_ts/1E3)},param:{search:{id:parseInt(a.entity.id),callid:a.entity.callid},location:{node:a.entity.dbnode},transaction:{call:!1,
registration:!1,rest:!1}}};d.param.transaction[a.entity.trans]=!0;m.open({url:"templates/dialogs/message.html",cls:"homer-modal-message",id:"message"+(""+a.entity.id+"_"+a.entity.trans).hashCode(),divLeft:b.clientX.toString()+"px",divTop:b.clientY.toString()+"px",params:d,onOpen:function(){console.log("modal1 message opened from url "+this.id)},controller:"messageCtrl"})};d.getColumnValue=function(a,b){return void 0==a.entity[b.field+"_alias"]?a.entity[b.field+"_ip"]:a.entity[b.field+"_alias"]};d.getColumnTooltip=
function(a,b){return a.entity[b.field+"_ip"]};d.showTransaction=function(b,c){var f=d.gridApi.selection.getSelectedRows(),l=[],e=[];l.push(b.entity.callid);-1==l.indexOf(b.entity.callid_aleg)&&1<b.entity.callid_aleg.length&&l.push(b.entity.callid_aleg);a.forEach(f,function(a,b){-1==l.indexOf(a.callid)&&l.push(a.callid);-1==l.indexOf(a.callid_aleg)&&1<a.callid_aleg.length&&l.push(a.callid_aleg);-1==e.indexOf(a.dbnode)&&e.push(a.dbnode)});var f={timestamp:{from:parseInt(b.entity.micro_ts/1E3)-300,to:parseInt(b.entity.micro_ts/
1E3)+300},param:{search:{id:parseInt(b.entity.id),callid:l},location:{node:e},transaction:{call:!1,registration:!1,rest:!1}}},h=n.getProfile("timerange");f.timestamp.to=h.to.getTime();f.param.transaction[b.entity.trans]=!0;h=""+b.entity.callid+"_"+b.entity.dbnode;e=n.getProfile("node");f.param.location.node=e.dbnode;m.open({url:"templates/dialogs/transaction.html",cls:"homer-modal-content",id:"trans"+h.hashCode(),params:f,divLeft:c.clientX.toString()/2+"px",divTop:c.clientY.toString()+"px",onOpen:function(){console.log("modal1 opened from url",
this.id)},controller:"transactionCtrl"})};d.fileOneUploaded=!0;d.fileTwoUploaded=!1;d.gridOpts={enableColumnResizing:!0,enableSorting:!0,enableRowSelection:!0,enableGridMenu:!0,showGridFooter:!0,noUnselect:!1,multiSelect:!0,modifierKeysToMultiSelect:!1,enablePaging:!0,paginationPageSizes:[25,50,75,100,150,200,300,400,500,600,800,1E3,2E3],paginationPageSize:25,enableFiltering:!0,rowTemplate:'<div ng-style="row.isSelected && {} || grid.appScope.getBkgColorTable(row.entity.callid)"><div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell></div></div>',
filterOptions:{filterText:"",useExternalFilter:!1},columnDefs:[{field:"id",displayName:"Id",width:50},{field:"milli_ts",displayName:"Date",cellFilter:"date:'yyyy-MM-dd HH:mm:ss.sss'",width:170},{field:"method",displayName:"Method",cellClass:function(a,b,d,c,f){if("INVITE"===a.getCellValue(b,d))return"blue"},cellTemplate:'<div  ng-click="grid.appScope.showMessage(row, $event)" class="ui-grid-cell-contents"><span class="navText">{{COL_FIELD}}</span></div>'},{field:"reply_reason",displayName:"Reason",
width:70},{field:"ruri_user",displayName:"RURI user"},{field:"from_user",displayName:"From User"},{field:"to_user",displayName:"To User"},{field:"callid",displayName:"CallID",width:160,cellTemplate:'<div  ng-click="grid.appScope.showTransaction(row, $event)" class="ui-grid-cell-contents"><span class="navText">{{COL_FIELD}}</span></div>'},{field:"callid_aleg",displayName:"CallID_AL",width:100,cellTemplate:'<div  ng-click="grid.appScope.showTransaction(row, $event)" class="ui-grid-cell-contents"><span class="navText">{{COL_FIELD}}</span></div>'},
{field:"user_agent",displayName:"User Agent"},{name:"source",field:"source_alias",displayName:"Source Host",cellTemplate:'<div title="{{ grid.appScope.getColumnTooltip(row, col) }}">{{COL_FIELD}}</div>'},{field:"source_port",displayName:"SPort",width:50},{field:"destination_alias",displayName:"Destination Host",cellTemplate:'<div title="{{ grid.appScope.getColumnTooltip(row, col) }}">{{ COL_FIELD }}</div>'},{field:"destination_port",displayName:"DPort",width:50},{field:"proto",displayName:"Proto",
width:40},{field:"node",displayName:"Node"},{field:"custom_field1",displayName:"Custom F1",visible:!1},{field:"custom_field2",displayName:"Custom F2",visible:!1},{field:"custom_field3",displayName:"Custom F3",visible:!1}]};d.gridOpts.rowIdentity=function(a){return a.id};d.gridOpts.onRegisterApi=function(a){d.gridApi=a}}}]).filter("unixts",function(){return function(a){return a?a:""}})})(angular,homer);(function(a,b){a.module(b.modules.pages.name).controller("drawCtrl",function(a,b){console.log("OPEN DATA");a.ok=function(){b.close("11")};a.close=function(){b.dismiss("cancel")}}).controller("messageCtrl",["$scope",b.modules.core.services.search,"$homerModal","$timeout","$homerModalParams","$sce",function(a,b,e,h,k,g){k=k.params;a.dataLoading=!0;a.showSipMessage=!0;a.showSipDetails=!1;a.clickSipDetails=function(){console.log("details")};b.searchMethod(k).then(function(b){a.msgId=b[0].id;a.msgCallId=
b[0].callid;a.msgDate=b[0].micro_ts/1E3;a.sipPath=b[0].source_ip+":"+b[0].source_port+" -> "+b[0].destination_ip+":"+b[0].destination_port;var c;c=b[0].msg;var m,e;c=c.split("<").join("&lt;");m=b[0].method;e="<font color='red'><b>"+m+"</b></font>";c=c.split(m).join(e);m=b[0].callid;e="<font color='blue'><b>"+m+"</b></font>";c=c.split(m).join(e);m=b[0].from_tag;e="<font color='red'><b>"+m+"</b></font>";c=c.split(m).join(e);m=b[0].via_1_branch;e="<font color='green'><b>"+m+"</b></font>";c=c.split(m).join(e);
c=g.trustAsHtml(c);a.sipMessage=c;c=[];for(var h in b[0])"msg"!=h&&b[0].hasOwnProperty(h)&&""!=b[0][h]&&c.push("<tr><td>"+h+"</td><td>"+b[0][h].split("<").join("&lt;")+"</td></tr>");c.push();a.sipDetails="<div id='"+b[0].id+"_details'><table class='table table-striped'>"+c.join("")+"</table></div>";a.trustedHtmlDetails=g.trustAsHtml(a.sipDetails)},function(a){console.log(a)})["finally"](function(){a.dataLoading=!1});h(function(){-1!==e.getOpenedModals().indexOf("tempModal")&&e.close("tempModal","var a",
"var b")},5E3)}]).controller("transactionCtrl",["$scope",b.modules.core.services.search,"$homerModal","$homerCflow","$timeout","$homerModalParams","$sce",function(b,c,e,h,k,g,f){var l=g.params;b.data=l;b.dataLoading=!0;b.showSipMessage=!0;b.showSipDetails=!1;b.clickSipDetails=function(){console.log("details")};b.id=g.id;b.transaction=[];b.clickArea=[];b.msgCallId=g.params.param.search.callid[0];b.collapsed=[];b.enableQualityReport=!1;b.enableRTCPReport=!1;b.enableLogReport=!1;b.enableXRTPReport=!1;
var m=function(){var a=defineExportTemplate(),c=new Date(b.transaction.calldata[0].milli_ts),c=c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds(),a=a.replace("#{date}",c);return a=$.tmpl(a,b.transaction.calldata[0])};b.exportCanvas=function(){var b=a.element(document.querySelectorAll("#"+g.id)),b=$(b).find("#cflowcanv"),c=document.createElement("a");c.download=m()+".png";c.href=b[0].toDataURL("image/png");c.click()};b.exportPCAP=function(){n(this.data,
!1,b.msgCallId)};b.exportTEXT=function(){n(this.data,!0,b.msgCallId)};b.exportShare=function(){b.sharelink="";c.createShareLink(l).then(function(a){a&&(b.sharelink=a[0])},function(a){})["finally"](function(){})};b.toggleTree=function(a){b.collapsed[a]=!b.collapsed[a]};b.drawCanvas=function(a,c){b.clickArea=h.setContext(a,c)};b.showMessage=function(a,b){var c={timestamp:{from:parseInt(a.micro_ts/1E3),to:parseInt(a.micro_ts/1E3)},param:{search:{id:parseInt(a.id),callid:a.callid},location:{node:a.dbnode},
transaction:{call:!1,registration:!1,rest:!1}}};c.param.transaction[a.trans]=!0;e.open({url:"templates/dialogs/message.html",cls:"homer-modal-message",id:"message"+(""+a.id+"_"+a.trans).hashCode(),divLeft:b.clientX.toString()+"px",divTop:b.clientY.toString()+"px",params:c,onOpen:function(){console.log("modal1 message opened from url "+this.id)},controller:"messageCtrl"})};b.checkMousePosition=function(c){var f=!1,l=null==c.offsetX?c.originalEvent.layerX-c.target.offsetLeft:c.offsetX,m=null==c.offsetY?
c.originalEvent.layerY-c.target.offsetTop:c.offsetY;a.forEach(b.clickArea,function(a){a.x1<l&&a.x2>l&&a.y1<m&&a.y2>m&&(f=!0)});return f};b.clickMousePosition=function(c){var f=!1,l={},m=null==c.offsetX?c.originalEvent.layerX-c.target.offsetLeft:c.offsetX,e=null==c.offsetY?c.originalEvent.layerY-c.target.offsetTop:c.offsetY;a.forEach(b.clickArea,function(a){a.x1<m&&a.x2>m&&a.y1<e&&a.y2>e&&(f=!0,l=a)});f&&("host"==l.type?console.log("clicked on host"):"message"==l.type&&b.showMessage(l.data,c));return f};
b.reDrawCanvas=function(){b.drawCanvas(b.id,b.transaction);$(window).resize()};c.searchTransaction(l).then(function(a){if(a&&(b.transaction=a,b.drawCanvas(g.id,a),0<a.rtpinfo.length&&(b.enableXRTPReport=!0,b.xrtpreport=a.rtpinfo),a.calldata)){console.log("Get call duration....");for(var c=[],f=0;f<a.calldata.length;f++)c.push(a.calldata[f].milli_ts);a=new Date(Math.max.apply(null,c));c=new Date(Math.min.apply(null,c));c=(a.getTime()-c.getTime())/1E3;a=new Date;a.setSeconds(c);b.sess_duration=a.toISOString().substr(11,
8)}},function(a){})["finally"](function(){b.dataLoading=!1});b.showRTCPReport=function(a){c.searchRTCPReport(a).then(function(a){0<a.length&&(console.log("RTCP",a),b.enableRTCPReport=!0,b.rtcpreport=a)},function(a){})["finally"](function(){b.dataLoading=!1})};b.showLogReport=function(a){c.searchLogReport(a).then(function(a){0<a.length&&(b.enableLogReport=!0,b.logreport=a)},function(a){})["finally"](function(){b.dataLoading=!1})};b.showQualityReport=function(a){c.searchQualityReport("short",a).then(function(a){if(0<
a.length){b.enableQualityReport=!0;b.qualityreport=a;b.vq_mos=[];b.vq_jit=[];b.vq_loss=[];b.vq_dates=[];for(var c in a)if(a.hasOwnProperty(c)){var f=JSON.stringify(a[c].msg).split("},").join("},<br>");b.vq_mos.push([f,parseFloat(a[c].msg.QualityEst.MOSCQ)]);b.vq_loss.push(parseFloat(a[c].msg.PacketLoss.NLR));b.vq_jit.push(parseFloat(a[c].msg.Delay.IAJ));b.vq_dates.push(a[c].date.split(" ")[1])}for(a=c=0;a<b.vq_mos.length;a++)c=parseFloat(c)+parseFloat(b.vq_mos[a][1]);b.vq_avg_mos=(c/b.vq_mos.length).toFixed(1);
for(a=c=0;a<b.vq_loss.length;a++)c=parseInt(c)+parseInt(b.vq_loss[a]);b.vq_avg_loss=c;for(a=c=0;a<b.vq_jit.length;a++)c=parseFloat(c)+parseFloat(b.vq_jit[a]);b.vq_avg_jit=(c/b.vq_jit.length).toFixed(1);b.chartConfig={chart:{polar:!0,type:"bar",backgroundColor:"rgba(255, 255, 255, 0.1)"},yAxis:[{title:{text:"MOS"}},{title:{text:"Packet Loss"},opposite:!0},{labels:{formatter:function(){return this.value+"ms"},style:{color:"#89A54E"}},title:{text:"Jitter",style:{color:"#89A54E"}},opposite:!0}],xAxis:{type:"datetime",
categories:b.vq_dates},series:[{data:b.vq_jit,name:"Jitter",type:"spline",yAxis:2},{data:b.vq_loss,name:"Packet Loss",type:"column",yAxis:1},{data:b.vq_mos,name:"MOS",type:"column",yAxis:0}],title:{text:""},size:{height:"250"},loading:!1}}},function(a){})["finally"](function(){b.dataLoading=!1})};b.showRTCPReport(l);b.showLogReport(l);b.showQualityReport(l);var n=function(a,b,f){c.makePcapTextforTransaction(a,b).then(function(a){var c=m()+".pcap",f="application/pcap";b&&(c=m()+".txt",f="attacment/text;charset=utf-8");
a=new Blob([a],{type:f});saveAs(a,c)},function(a){})["finally"](function(){})};k(function(){-1!==e.getOpenedModals().indexOf("tempModal")&&e.close("tempModal","var a","var b")},5E3);b.treedata2=[{id:1,title:"node1",nodes:[{id:11,title:"node1.1",nodes:[{id:111,title:"node1.1.1",nodes:[]}]},{id:12,title:"node1.2",nodes:[]}]},{id:2,title:"node2",nodes:[{id:21,title:"node2.1",nodes:[]},{id:22,title:"node2.2",nodes:[]}]},{id:3,title:"node3",nodes:[{id:31,title:"node3.1",nodes:[]}]}]}])})(angular,homer);(function(a,b){a.module(b.modules.pages.name).controller(b.modules.pages.controllers.navigation,["$scope","$location","$rootScope","eventbus",b.modules.auth.services.authentication,b.modules.core.services.store,function(a,c,e,h,k,g){a.showChilds=function(a){console.log(a);a.active=!a.active};a.addNewDashboard=function(b){var c="_"+(new Date).getTime();g.set(c,{title:b,structure:"4-8",rows:[{columns:[{styleClass:"col-md-4",widgets:[]},{styleClass:"col-md-8",widgets:[]}]}]});g.getAll().then(function(b){a.items=
b.data;a.items[2].active=!0;console.log(a.items[2])},function(){})["finally"](function(){})};a.isActive=function(a){return a===c.path()};h.subscribe(b.modules.pages.events.newDashboardItem,function(b,c){a.addNewDashboard(c)});h.subscribe(b.modules.pages.events.dashBoardChanged,function(b,c){g.getAll().then(function(b){console.log(b.data);a.items=b.data;a.items[2].active=!0},function(){})["finally"](function(){})});g.getAll().then(function(b){a.items=b.data},function(){})["finally"](function(){})}])})(angular,
homer);(function(a,b){a.module(b.modules.pages.name).controller(b.modules.pages.controllers.dashboard,["$scope","$state","$stateParams","$location","$rootScope","eventbus",b.modules.auth.services.authentication,b.modules.core.services.store,"SweetAlert",function(a,c,e,h,k,g,f,l,m){if(0==k.loggedIn)console.log("AUTH FALSE DASHBOARD"),h.path(b.modules.auth.routes.login);else{console.log("AUTH TRUE DASHBOARD");sipcaptureWdgt&&sipcaptureWdgt.d3.clear();"search"==c.current.name?e.boardID="search":"home"==c.current.name?
e.boardID="home":"alarm"==c.current.name&&(e.boardID="alarm");this.name=e.boardID;var n=this;l.get(e.boardID).then(function(a){var b=f.getCurrentLoginUser();k.dashboardEditable=!1;-1<b.permissions.indexOf("admins")&&(k.dashboardEditable=!0);n.model=a});this["delete"]=function(a){m.swal({title:"Are you sure?",text:"Your will not be able to recover this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(c){c&&
(l["delete"](a),h.path("/home"),g.broadcast(b.modules.pages.events.dashBoardChanged,a))})};g.subscribe(b.modules.pages.events.adfEvent,function(a,c,f){l.set(c,f);a=!1;var d="",m="",e=10,h="";f.hasOwnProperty("protect")&&(a=f.protect);f.hasOwnProperty("title")&&(m=f.title);f.hasOwnProperty("weight")&&(e=f.weight);f.hasOwnProperty("alias")&&(h=f.alias);f.hasOwnProperty("selectedItem")&&(d=f.selectedItem);l.menu(c,{param:{protect:a,title:m,weight:e,alias:h,icon:d}}).then(function(a){console.log("update")},
function(){console.log("wrong reply")})["finally"](function(){g.broadcast(b.modules.pages.events.dashBoardChanged,c)})});g.subscribe(b.modules.pages.events.adfDeleteEvent,function(a,b){n["delete"](b)})}}])})(angular,homer);(function(a,b){a.module(b.modules.pages.name).directive("resize",function(b){return function(c,e){var h=a.element(b);c.getWindowDimensions=function(){return{h:h.height(),w:h.width()}};c.$watch(c.getWindowDimensions,function(a,b){$(".gridStyle").height(a.h-180)},!0);h.bind("resize",function(){c.$apply()})}}).directive("afterRender",["$window","$timeout",function(a){return{restrict:"A",terminal:!0,transclude:!1,link:function(a,b,d){d&&a.$eval(d.afterRender);a.$emit("onAfterRender")}}}]).directive("modal",
function(){return{template:'<div class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">{{ title }}</h4></div><div class="modal-body" ng-transclude></div></div></div></div>',restrict:"E",transclude:!0,replace:!0,scope:!0,link:function(a,b,e){a.title=e.title;a.$watch(e.visible,function(a){1==a?$(b).modal("show"):$(b).modal("hide")});$(b).on("shown.bs.modal",
function(){a.$apply(function(){a.$parent[e.visible]=!0})});$(b).on("hidden.bs.modal",function(){a.$apply(function(){a.$parent[e.visible]=!1})})}}}).directive("draggable",function(){return{restrict:"EA",link:function(a,b){$(b).draggable({cancel:".homer-modal-body, .close",handle:".homer-modal-header"}).resizable({resize:function(e,h){var k=$(b).find("#cflowcanv");0<$(k).length&&a.reDrawCanvas();k=$(b).find(".homer-modal-body");$(k).width(h.size.width-10);$(k).height(h.size.height-50)}})}}})})(angular,
homer);angular.module("homer.widgets.sipcapture",["adf.provider","highcharts-ng","angular-flot"]).value("localApiUrl","api/v1/").value("sipcaptureApiUrl","api/v1/").config(function(a){a.widget("sipcaptureChart",angular.extend({title:"Sipcapture Stats",group:"Charts",name:"sipcaptureChart",description:"Display SIPCapture API data",controller:"sipcaptureCtrl"},{templateUrl:"js/widgets/sipcapture/sipcapture.html",reload:!0,resolve:{sipdata:function(a,d,c){if(c.path&&c.query)return d.get(a,c,c.path,c.query)}},
edit:{templateUrl:"js/widgets/sipcapture/edit.html",controller:"sipcaptureEditController"},refresh:!0}))}).service("sipcaptureService",function(a,b,d,c){return{get:function(e,h,k,g){var f=a.defer();k=d+k;var l={};try{if(l=JSON.parse(g),!l.timestamp)return f.reject(),f.promise}catch(m){return f.reject(),f.promise}l=sipcaptureWdgt.query(e,l,c);b.post(k,l).success(function(a){h.debugresp=JSON.stringify(a);a&&a.status&&(300>a.status?f.resolve(a.data):f.reject(a.data))}).error(function(){f.reject()});
return f.promise}}}).directive("contenteditable",function(){return{require:"ngModel",link:function(a,b,d,c){function e(){c.$setViewValue(b.html())}c.$render=function(){b.html(c.$viewValue||"").text()};b.bind("keydown keypress",function(b){13===b.which&&(b.preventDefault(),a.$apply(d.ngEnter))});b.bind("blur keyup change",function(){a.$apply(e)});b.bind("keydown keypress",function(){a.$apply(e)})}}}).controller("sipcaptureCtrl",function(a,b,d,c,e){function h(c){var f={};angular.forEach(c,function(a){var c=
1E3*a[b.panel.timefield.field],d=[];angular.forEach(k,function(b){d.push(a[b.type])});var l=d.join("|"),e=0,e=parseInt(a.total);f.hasOwnProperty(l)||(f[l]=[]);f[l].push([c,e])});var d=[];"pie"==b.chart.type.value?(d.push({type:b.chart.type.value,name:a.$parent.model.title,data:[]}),angular.forEach(f,function(a,b){var c=0;angular.forEach(a,function(a){c+=a[1]});d[0].data.push([b,c])})):angular.forEach(f,function(a,c){var f={};f.name=c;f.type=b.chart.type.value;a.sort(function(a,b){return a[0]-b[0]});
f.data=a;d.push(f)});return d}var k=a.config.panel.filters;a.reloadIt=function(){console.log("reloading");a.$parent.changeReloading(!0);c.get(a,b,b.path,b.query).then(function(c){if(b.chart.hasOwnProperty("library")&&"d3"==b.chart.library.value)sipcaptureWdgt.d3.draw(a,b.chart.type.value,c),a.$parent.changeReloading(!1);else if(b.chart.hasOwnProperty("library")&&"flot"==b.chart.library.value)sipcaptureWdgt.flot.draw(a,b.chart.type.value,c),a.$parent.changeReloading(!1);else{c=h(c);for(var f=a.chartObj,
d=c.length,m=0,e=f.series.length;m<e;m++)m<d?f.series[m].update(c[m],!0):f.series[m]&&f.series[m].remove(!1);for(m=0;m<d;m++)f.addSeries(c[m],!0);a.$parent.changeReloading(!1);console.log("RELOADING")}},function(a){console.log("data")})};a.handlePlotSelected=function(a,b){console.log("Selected:",a);console.log("Ranges:",b);var c={from:new Date(b.xaxis.from),to:new Date(b.xaxis.to)};console.log(c);e.broadcast(homer.modules.pages.events.setTimeRange,c);e.broadcast("globalWidgetReload",1)};d&&(b.chart.hasOwnProperty("library")&&
"d3"==b.chart.library.value?(a.d3Enabled=!0,a.chartHeight=b.chart.size.height,sipcaptureWdgt.d3.draw(a,b.chart.type.value,d)):b.chart.hasOwnProperty("library")&&"flot"==b.chart.library.value?(a.flotEnabled=!0,a.chartHeight=b.chart.size.height,a.chartWidth=b.chart.size.width,sipcaptureWdgt.flot.draw(a,b.chart.type.value,d)):(a.chartHighchart=!0,d=h(d),"pie"==b.chart.type.value?(a.chartConfig={chart:{type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.$parent.model.title,
style:{display:"none"}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:0,dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},showInLegend:!1}},series:d},b.chart.ccc&&(d=[],d=b.chart.ccc.split(","),a.chartConfig.hasOwnProperty("colors")||(a.chartConfig.colors=[]),a.chartConfig.colors=d),b.chart.ddd&&(a.chartConfig.chart.options3d={enabled:!0,alpha:45,beta:0},a.chartConfig.plotOptions.pie.depth=35),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||
(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&(a.chartConfig.size.width=b.chart.size.width),0<parseInt(b.chart.size.height)?a.chartConfig.size.height=b.chart.size.height:a.chartConfig.size.height=300),b.chart.legend&&b.chart.legend.enabled&&1==b.chart.legend.enabled&&(a.chartConfig.plotOptions.pie.showInLegend=b.chart.legend.enabled,a.chartConfig.plotOptions.pie.dataLabels.enabled=!1)):(a.chartConfig={chart:{type:b.chart.type.value},title:{text:a.$parent.model.title,style:{display:"none"}},
xAxis:{title:{text:null},type:"datetime"},yAxis:{title:{text:null},min:0},plotOptions:{column:{}},tooltip:{},legend:{enabled:!1,borderWidth:0},series:d},a.chartConfig.chart.zoomType="x",a.chartConfig.tooltip.crosshairs=!0,a.chartConfig.tooltip.shared=!0,b.chart.ccc&&(d=[],d=b.chart.ccc.split(","),a.chartConfig.colors=d),b.chart.sss&&(d=b.chart.type.value,a.chartConfig.plotOptions[d]={},a.chartConfig.plotOptions[d].stacking=b.chart.ppp?"percent":"normal"),b.chart.ddd&&(a.chartConfig.chart.options3d=
{enabled:!0,alpha:15,beta:10,depth:50,viewDistance:30},a.chartConfig.plotOptions.column.depth=25,a.chartConfig.chart.margin=60),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&(a.chartConfig.size.width=b.chart.size.width),0<parseInt(b.chart.size.height)&&(a.chartConfig.size.height=b.chart.size.height)),b.chart.legend&&(b.chart.legend.align&&(a.chartConfig.legend.align=b.chart.legend.align),b.chart.legend.enabled&&(a.chartConfig.legend.enabled=
b.chart.legend.enabled),b.chart.legend.layout&&(a.chartConfig.legend.layout=b.chart.legend.layout)),b.chart.yaxis&&b.chart.yaxis.title&&0<b.chart.yaxis.title.length&&(a.chartConfig.yAxis.title.text=b.chart.yaxis.title),b.chart.xaxis&&b.chart.xaxis.title&&0<b.chart.xaxis.title.length&&(a.chartConfig.xAxis.title.text=b.chart.xaxis.title))))}).controller("sipcaptureEditController",function(a,b,d,c){a.charts=[{id:1,label:"Spline",value:"spline"},{id:2,label:"Line",value:"line"},{id:3,label:"Area spline",
value:"areaspline"},{id:4,label:"Bar",value:"bar"},{id:5,label:"Scatter",value:"scatter"},{id:6,label:"Pie",value:"pie"},{id:7,label:"Column",value:"column"},{id:8,label:"Gauge",value:"solidgauge"},{id:9,label:"Heatbox",value:"heatmap"}];a.library=[{id:1,label:"Highchart",value:"higchart"},{id:3,label:"D3JS",value:"d3"},{id:4,label:"Flot",value:"flot"}];a.legend_align=[{name:"center",value:"center"},{name:"right",value:"right"},{name:"left",value:"left"}];a.legend_layout=[{name:"horizontal",value:"horizontal"},
{name:"vertical",value:"vertical"}];a.updateDebugUrl=function(){var e=d+a.config.path;try{var h=JSON.parse(a.config.query),h=sipcaptureWdgt.query(a,h,c);a.debug="curl -v --cookie 'HOMERSESSID="+b.HOMERSESSID+"' -X POST \\\n-d '"+JSON.stringify(h)+"' \\\n \""+window.location.protocol+"//"+window.location.host+"/"+e+'"\n';a.parsingStatus="ok";a.parsingColorClass="green"}catch(k){a.parsingStatus="Bad parsing: ["+k.message+"]",a.parsingColorClass="red"}};a.datasources=sipcaptureWdgt.data.datasources.datasources;
$("body").on("change","#widgetDatasources",function(){$("#query").val(a.config.panel.datasource.settings.query).trigger("change");$("#path").val(a.config.panel.datasource.settings.path).trigger("change")});a.updateDebugUrl();a.selectType=function(){a.config.panel.total="pie"==a.config.chart.type.value?!0:!1};a.selectEngine=function(){a.config.chart.update.clear()};a.addFilter=function(){a.config.panel.filters||(a.config.panel.filters=[]);a.config.panel.filters.push({type:a.config.panel.filter.type,
value:a.config.panel.filtervalue.value})};a.removeFilter=function(b){a.config.panel.filters.splice(b,1)};a.reset=function(b){a.config.panel.values=[];a.config.panel.filters=[]}});
var sipcaptureWdgt={capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()},service:{},query:function(a,b,d){d=d.getProfile("timerange");var c=a.config.panel.filters,e=[];b.timestamp.from=d.from.getTime();b.timestamp.to=d.to.getTime();b.param.limit=a.config.panel.limit;b.param.total=a.config.panel.total;"object"==typeof c&&(c.forEach(function(a){var b={};b[a.type]=a.value;e.push(b)}),b.param.filter=e);return b},d3:{duration:1E3,events:[]},generateId:function(a){if(!a.d3Selector){var b=
"d3"+Math.floor(10001*Math.random()),d=document.getElementById(b);"undefined"!=typeof d&&null!=d?sipcaptureWdgt.generateId(a):(a.d3ID=b,a.d3Selector="#"+b);return!0}return!1}};sipcaptureWdgt.d3.checkRequeriments=function(a){return a.config.panel.timefield.field?"object"!=typeof a.config.panel.filters?(console.error("Please define filters in "+a.$parent.model.title),!1):!0:(console.error("Please define a timefield in "+a.$parent.model.title),!1)};
sipcaptureWdgt.d3.create=function(a,b,d,c){var e=a.d3Selector,h=a.config.chart.update;"function"==typeof h&&h.clear();b.showLegend(a.config.chart.legend.enabled);b.xAxis&&(a.config.chart.yaxis&&a.config.chart.yaxis.title&&0<a.config.chart.yaxis.title.length&&b.yAxis.axisLabel(a.config.chart.yaxis.title),a.config.chart.xaxis&&a.config.chart.xaxis.title&&0<a.config.chart.xaxis.title.length&&b.xAxis.axisLabel(a.config.chart.xaxis.title));a.config.chart.ccc&&(h=[],h=a.config.chart.ccc.split(","),b.color(h));
d=d3.select(e).datum(d);c&&d.transition().duration(sipcaptureWdgt.d3.duration);d.call(b);h=nv.utils.windowResize(b.update);a.config.chart.update=h;sipcaptureWdgt.d3.events.push(h)};sipcaptureWdgt.d3.clear=function(){sipcaptureWdgt.d3.events.forEach(function(a){a.clear()})};
sipcaptureWdgt.d3.data=function(a,b){var d=a.config.panel.timefield.field,c=a.config.panel.filters,e=[],h={},k=[],g,f=[];b.forEach(function(a){var b="",f=0;c.forEach(function(c){a[c.type]&&(b&&(b+=" | "),b+=a[c.type])});f=parseInt(a.total);-1===e.indexOf(b)&&e.push(b);g=a[d];-1===k.indexOf(g)&&k.push(g);b in h||(h[b]={});h[b][g]=(h[b][g]||0)+f});e.forEach(function(a){var b=[],c=0;k.forEach(function(f){c+=parseInt(h[a][f])||0;b.push({timefield:f,value:parseInt(h[a][f])||0})});f.push({key:a,values:b,
value:c})});return f};sipcaptureWdgt.d3.scatterChart={};sipcaptureWdgt.d3.scatterChart.data=function(a){var b,d="circle cross triangle-up triangle-down diamond square".split(" ");a.forEach(function(a){b=a.values;var e=d[0];e?d.shift():e="circle";b.forEach(function(a){a.size=a.value;a.shape=e})});return a};
sipcaptureWdgt.d3.scatterChart.prepare=function(a,b,d){nv.addGraph(function(){var c=nv.models.scatterChart().showDistX(!0).showDistY(!0).x(function(a){return a.timefield}).y(function(a){return a.value}).color(d3.scale.category10().range());c.xAxis.tickFormat(function(a){return d3.time.format("%H:%M")(new Date(1E3*a))});c.yAxis.tickFormat(d3.format("d"));c.xScale(d3.time.scale());sipcaptureWdgt.d3.create(a,c,d,b);return c})};sipcaptureWdgt.d3.lineChart={};
sipcaptureWdgt.d3.lineChart.prepare=function(a,b,d){nv.addGraph(function(){var c=nv.models.lineWithFocusChart().x(function(a){return a.timefield}).y(function(a){return a.value}),e=0;c.dispatch.on("brush",function(b){null!=this.timeout&&(clearTimeout(this.timeout),e++);this.timeout=setTimeout(function(){this.timeout=null;var c={from:new Date(1E3*b.extent[0]),to:new Date(1E3*b.extent[1])};2<e&&(a.$parent.$root.setRange("timerange",c),e=0)}.bind(this),1500)});c.xAxis.tickFormat(function(a){return d3.time.format("%H:%M")(new Date(1E3*
a))});c.yAxis.tickFormat(d3.format("d"));c.xScale(d3.time.scale());c.isArea(!0);c.focusHeight(30);c.y2Axis.tickFormat(function(a){});c.x2Axis.tickFormat(function(a){});sipcaptureWdgt.d3.create(a,c,d,b);return c})};sipcaptureWdgt.d3.stackedAreaChart={};
sipcaptureWdgt.d3.stackedAreaChart.prepare=function(a,b,d){nv.addGraph(function(){var c=nv.models.stackedAreaChart().clipEdge(!0).x(function(a){return a.timefield}).y(function(a){return a.value});c.xAxis.tickFormat(function(a){return d3.time.format("%H:%M")(new Date(1E3*a))});c.yAxis.tickFormat(d3.format("d"));sipcaptureWdgt.d3.create(a,c,d,b);return c})};sipcaptureWdgt.d3.multiBarChart={};
sipcaptureWdgt.d3.multiBarChart.prepare=function(a,b,d){nv.addGraph(function(){var c=nv.models.multiBarChart().x(function(a){return a.timefield}).y(function(a){return a.value});c.yAxis.tickFormat(d3.format("d"));c.xAxis.tickFormat(function(a){return d3.time.format("%H:%M")(new Date(1E3*a))});sipcaptureWdgt.d3.create(a,c,d,b);return c})};sipcaptureWdgt.d3.pieChart={};
sipcaptureWdgt.d3.pieChart.prepare=function(a,b,d){nv.addGraph(function(){var c=nv.models.pieChart().x(function(a){return a.key}).y(function(a){return a.value}).valueFormat(d3.format("d")).showLabels(!1).legendPosition("right").margin({top:0,right:0,bottom:0,left:0});sipcaptureWdgt.d3.create(a,c,d,b);return c})};
sipcaptureWdgt.d3.draw=function(a,b,d){if(sipcaptureWdgt.d3.checkRequeriments(a)){var c=sipcaptureWdgt.generateId(a);d=sipcaptureWdgt.d3.data(a,d);"pie"==b?sipcaptureWdgt.d3.pieChart.prepare(a,c,d):"scatter"==b?(d=sipcaptureWdgt.d3.scatterChart.data(d),sipcaptureWdgt.d3.scatterChart.prepare(a,c,d)):"line"==b?sipcaptureWdgt.d3.lineChart.prepare(a,c,d):"areaspline"==b?sipcaptureWdgt.d3.stackedAreaChart.prepare(a,c,d):sipcaptureWdgt.d3.multiBarChart.prepare(a,c,d)}else console.error("You should update your widget settings in "+
a.$parent.model.title)};sipcaptureWdgt.flot={duration:1E3,events:[]};
sipcaptureWdgt.flot.data=function(a,b){var d=a.config.panel.timefield.field,c=a.config.panel.filters,e=[],h={},k=[],g,f=[];b.forEach(function(a){var b="",f=0;c.forEach(function(c){a[c.type]&&(b&&(b+=" | "),b+=a[c.type])});f=parseInt(a.total);-1===e.indexOf(b)&&e.push(b);g=a[d];-1===k.indexOf(g)&&k.push(g);b in h||(h[b]={});h[b][g]=(h[b][g]||0)+f});e.forEach(function(a){var b=[],c=0;k.forEach(function(f){c+=parseInt(h[a][f])||0;b.push([1E3*f,parseInt(h[a][f])||0])});f.push({label:a,data:b,value:c})});
return f};sipcaptureWdgt.flot.clear=function(){sipcaptureWdgt.flot.events.forEach(function(a){a.clear()})};sipcaptureWdgt.flot.checkRequeriments=function(a){return a.config.panel.timefield.field?"object"!=typeof a.config.panel.filters?(console.error("Please define filters in "+a.$parent.model.title),!1):!0:(console.error("Please define a timefield in "+a.$parent.model.title),!1)};sipcaptureWdgt.flot.lineChart={};
sipcaptureWdgt.flot.lineChart.prepare=function(a,b,d){a.flotOptions={colors:[],xaxis:{mode:"time",timeformat:"%H:%M"},grid:{hoverable:!0,borderWidth:0},legend:{noColumns:0,show:!1},tooltip:{show:!0,content:"%s | time: %x; value: %y"},selection:{mode:"x",color:"#666"}};a.config.chart.legend&&a.config.chart.legend.enabled&&1==a.config.chart.legend.enabled&&(a.flotOptions.legend.show=!0);a.config.chart.ccc&&(a.flotOptions.colors=a.config.chart.ccc.split(","));a.flotData=d;return 1};
sipcaptureWdgt.flot.stackedAreaChart={};
sipcaptureWdgt.flot.stackedAreaChart.prepare=function(a,b,d){a.flotOptions={colors:[],xaxis:{mode:"time",timeformat:"%H:%M"},grid:{borderWidth:0,hoverable:!0},series:{stack:0,lines:{show:!0,fill:!0,steps:!1}},legend:{noColumns:0,show:!1},tooltip:{show:!0,content:"%s | time: %x; value: %y"},selection:{mode:"x",color:"#666"}};a.config.chart.legend&&a.config.chart.legend.enabled&&1==a.config.chart.legend.enabled&&(a.flotOptions.legend.show=!0);a.config.chart.ccc&&(a.flotOptions.colors=a.config.chart.ccc.split(","));
if(d.length>a.flotOptions.colors.length){b=d.length-a.flotOptions.colors.length;for(var c=0;c<b;c++)a.flotOptions.colors.push(sipcaptureWdgt.colorRandom(c))}a.flotData=d;return 1};sipcaptureWdgt.flot.scatterChart={};
sipcaptureWdgt.flot.scatterChart.prepare=function(a,b,d){a.flotOptions={colors:[],xaxis:{mode:"time",timeformat:"%H:%M"},grid:{borderWidth:0,hoverable:!0},series:{points:{show:!0,radius:3}},legend:{noColumns:0,show:!1},tooltip:{show:!0,content:"%s | time: %x; value: %y"},selection:{mode:"x",color:"#666"}};a.config.chart.legend&&a.config.chart.legend.enabled&&1==a.config.chart.legend.enabled&&(a.flotOptions.legend.show=!0,a.flotOptions.legend.position="ne");a.config.chart.ccc&&(a.flotOptions.colors=
a.config.chart.ccc.split(","));if(d.length>a.flotOptions.colors.length){b=d.length-a.flotOptions.colors.length;for(var c=0;c<b;c++)a.flotOptions.colors.push(sipcaptureWdgt.colorRandom(c))}a.flotData=d;return 1};sipcaptureWdgt.flot.pieChart={};
sipcaptureWdgt.flot.pieChart.prepare=function(a,b,d){a.flotOptions={colors:[],xaxis:{mode:"time",timeformat:"%H:%M"},grid:{borderWidth:0,hoverable:!0},series:{pie:{show:!0}},legend:{show:!1},tooltip:{show:!0,content:"%s | time: %x; value: %y"}};a.config.chart.legend&&a.config.chart.legend.enabled&&1==a.config.chart.legend.enabled&&(a.flotOptions.legend.show=!0,a.flotOptions.legend.position="ne");a.config.chart.ccc&&(a.flotOptions.colors=a.config.chart.ccc.split(","));if(d.length>a.flotOptions.colors.length){b=
d.length-a.flotOptions.colors.length;for(var c=0;c<b;c++)a.flotOptions.colors.push(sipcaptureWdgt.colorRandom(c))}a.flotData=d;return 1};sipcaptureWdgt.flot.multiBarChart={};
sipcaptureWdgt.flot.multiBarChart.prepare=function(a,b,d){a.flotOptions={colors:[],xaxis:{mode:"time",timeformat:"%H:%M"},grid:{borderWidth:0,hoverable:!0},series:{bars:{show:!0,barWidth:.6,align:"center"}},legend:{noColumns:0,position:"ne",show:!1},tooltip:{show:!0,content:"%s | time: %x; value: %y"}};a.config.chart.legend&&a.config.chart.legend.enabled&&1==a.config.chart.legend.enabled&&(a.flotOptions.legend.show=!0,a.flotOptions.legend.position="ne");a.config.chart.ccc&&(a.flotOptions.colors=a.config.chart.ccc.split(","));
if(d.length>a.flotOptions.colors.length){b=d.length-a.flotOptions.colors.length;for(var c=0;c<b;c++)a.flotOptions.colors.push(sipcaptureWdgt.colorRandom(c))}a.flotData=d;return 1};
sipcaptureWdgt.flot.draw=function(a,b,d){if(sipcaptureWdgt.flot.checkRequeriments(a)){var c=sipcaptureWdgt.generateId(a);d=sipcaptureWdgt.flot.data(a,d);"pie"==b?sipcaptureWdgt.flot.pieChart.prepare(a,c,d):"scatter"==b?(d=sipcaptureWdgt.flot.scatterChart.data(d),sipcaptureWdgt.flot.scatterChart.prepare(a,c,d)):"line"==b?sipcaptureWdgt.flot.lineChart.prepare(a,c,d):"areaspline"==b?sipcaptureWdgt.flot.stackedAreaChart.prepare(a,c,d):sipcaptureWdgt.flot.multiBarChart.prepare(a,c,d)}else console.error("You should update your widget settings in "+
a.$parent.model.title)};sipcaptureWdgt.colorRandom=function(a){a="0123456789ABCDEF".split("");for(var b="#",d=0;6>d;d++)b+=a[Math.floor(16*Math.random())];return b};sipcaptureWdgt.data={};
sipcaptureWdgt.data.datasources={version:1,datasources:[{name:"Method",type:"JSON",settings:{path:"statistic/method",query:'{\n   "timestamp": {\n          "from": "@from_ts",\n          "to":  "@to_ts"\n   },\n  "param": {\n        "filter": [ \n             "@filters"\n       ],\n       "limit": "@limit",\n       "total": "@total"\n   }\n}',method:"GET",limit:200,total:!1,eval:{incoming:{name:"test incoming",value:"var object = @incoming; return object"}},timefields:[{field:"from_ts",desc:"From Timestamp"},
{field:"to_ts",desc:"To Timestamp"}],fieldvalues:[{field:"total",desc:"All Packets"}],filters:[{type:"method",desc:"SIP Method",options:[{value:"!ALL"},{value:"!TOTAL"},{value:"TOTAL"},{value:"INVITE"},{value:"UPDATE"},{value:"REGISTER"},{value:"CANCEL"},{value:"BYE"},{value:"OPTIONS"},{value:"300"},{value:"401"},{value:"407"},{value:"200"}]},{type:"cseq",desc:"SIP Cseq",options:[{value:"INVITE"},{value:"UPDATE"},{value:"REGISTER"},{value:"CANCEL"},{value:"BYE"},{value:"OPTIONS"}]},{type:"auth",desc:"SIP Auth",
options:[{value:"true"}]},{type:"totag",desc:"SIP To Tag",options:[{value:"true"}]}]}},{name:"Data",type:"JSON",settings:{path:"statistic/data",query:'{\n   "timestamp": {\n          "from": "@from_ts",\n          "to":  "@to_ts"\n   },\n  "param": {\n        "filter": [ \n             "@filters"\n       ],\n       "limit": "@limit",\n       "total": "@total"\n   }\n}',method:"GET",limit:200,total:!1,eval:{incoming:{name:"test incoming",value:"var object = @incoming; return object"}},timefields:[{field:"from_ts",
desc:"From Timestamp"},{field:"to_ts",desc:"To Timestamp"}],fieldvalues:[{field:"total",desc:"All Packets"}],filters:[{type:"type",desc:"Data Statistics",options:[{value:"asr",desc:"Answer Seizure Ratio"},{value:"ner",desc:"Network Effectiveness Ratio"},{value:"packet_size",desc:"Packet Size"},{value:"packet_count",desc:"Packet Count"},{value:"sdf",desc:"counter of call\u2019s releases except busy and normal call clearing (17 && 16)"},{value:"isa",desc:"counter of replies on INVITE: 408|50[03]"},
{value:"sd",desc:"counter of replies on INVITE: 50[034]"},{value:"ssr",desc:"call success setup rate"}]}]}},{name:"IP",type:"JSON",settings:{path:"statistic/ip",query:'{\n   "timestamp": {\n          "from": "@from_ts",\n          "to":  "@to_ts"\n   },\n  "param": {\n        "filter": [ \n             "@filters"\n       ],\n       "limit": "@limit",\n       "total": "@total"\n   }\n}',method:"GET",limit:200,total:!1,eval:{incoming:{name:"test incoming",value:"var object = @incoming; return object"}},
timefields:[{field:"from_ts",desc:"From Timestamp"},{field:"to_ts",desc:"To Timestamp"}],fieldvalues:[{field:"total",desc:"All Packets"}],filters:[{type:"method",desc:"SIP Method",options:[{value:"!ALL"},{value:"!TOTAL"},{value:"TOTAL"},{value:"INVITE"},{value:"UPDATE"},{value:"REGISTER"},{value:"CANCEL"},{value:"BYE"},{value:"OPTIONS"},{value:"300"},{value:"401"},{value:"407"},{value:"200"}]},{type:"source_ip",desc:"SIP Source IP",options:[]}]}},{name:"User-Agent",type:"JSON",settings:{path:"statistic/useragent",
query:'{\n   "timestamp": {\n          "from": "@from_ts",\n          "to":  "@to_ts"\n   },\n  "param": {\n        "filter": [ \n             "@filters"\n       ],\n       "limit": "@limit",\n       "total": "@total"\n   }\n}',method:"GET",limit:200,total:!1,eval:{incoming:{name:"test incoming",value:"var object = @incoming; return object"}},timefields:[{field:"from_ts",desc:"From Timestamp"},{field:"to_ts",desc:"To Timestamp"}],fieldvalues:[{field:"total",desc:"All Packets"}],filters:[{type:"useragent",
desc:"SIP User-Agent",options:[{value:"!ALL"},{value:"!TOTAL"},{value:"TOTAL"},{value:"INVITE"},{value:"UPDATE"},{value:"REGISTER"},{value:"CANCEL"},{value:"BYE"},{value:"OPTIONS"},{value:"300"},{value:"401"},{value:"407"},{value:"200"}]},{type:"method",desc:"SIP Method",options:[{value:"!ALL"},{value:"!TOTAL"},{value:"TOTAL"},{value:"INVITE"},{value:"UPDATE"},{value:"REGISTER"},{value:"CANCEL"},{value:"BYE"},{value:"OPTIONS"},{value:"300"},{value:"401"},{value:"407"},{value:"200"}]}]}}]};
$.fn.extend({toggleText:function(a,b){this.text()==a?this.text(b):this.text(a)}});$(document).ready(function(){$("body").on("click","#seeChartExpert",function(a){a.preventDefault();$("#chartExpert").toggleClass("hidden");$("#seeChartExpert .glyphicon").toggleClass("glyphicon-chevron-down glyphicon-chevron-up");$("#seeChartExpert .text").toggleText("Switch to expert mode","Switch to normal mode")})});angular.module("homer.widgets.querycap",["adf.provider","highcharts-ng"]).value("localApiUrl","api/v1/").value("querycapApiUrl","http://homer.yourhost.org:8086").config(function(a){a.widget("querycapChart",angular.extend({title:"QueryCapture",group:"Charts",name:"querycapChart",description:"Display QueryCapture API data as charts",controller:"querycapCtrl"},{templateUrl:"js/widgets/querycap/querycap.html",reload:!0,resolve:{sipdata:function(a,d,c){c.query||(c.query='select * from "homer.stats.counters.polycomMos.count" where time > $fromts AND time < $tots;');
c.path||(c.path="http://127.0.0.1:8086/query");c.db||(c.db={});c.db.user||(c.db.user="root");c.db.password||(c.db.password="root");c.db.name||(c.db.name="homer_stats");c.source||(c.source={});c.source.main||(c.source.main="results");c.source.sub||(c.source.sub="series");c.panel||(c.panel={});c.panel.timefield||(c.panel.timefield="time");c.panel.fieldname||(c.panel.fieldname="name");c.panel.fieldvalue||(c.panel.fieldvalue="value");c.chart.maxvalue||(c.chart.maxvalue=0);if(c.path&&c.query&&c.db)return d.get(c,
c.path,c.query)}},edit:{templateUrl:"js/widgets/querycap/edit.html",controller:"querycapEditController"},refresh:!0}))}).service("querycapService",function(a,b,d,c){return{get:function(d,h,k){var g=a.defer(),f=c.getProfile("timerange");k=k.replace(/\$fromts/g,1E3*f.from.getTime()+"u");k=k.replace(/\$tots/g,1E3*f.to.getTime()+"u");h=h+"?u="+d.db.user+"&p="+d.db.password+"&db="+d.db.name+"&q="+encodeURIComponent(k);b.defaults.useXDomain=!0;delete b.defaults.headers.common.Authorization;b.get(h).success(function(a){var b=
a.results;d.source&&d.source.main&&(b=a[d.source.main]);g.resolve(b)}).error(function(){g.reject()});return g.promise}}}).controller("querycapCtrl",function(a,b,d,c,e){function h(c){var d={};angular.forEach(c,function(a){var c=a.series;b.source.sub&&(c=a[b.source.sub]);angular.forEach(c,function(a){var c=a.name;b.panel.fieldname&&(c=a[b.panel.fieldname]);angular.forEach(a.values,function(a){var f=(new Date(a[0])).getTime();a=a[1];0<b.panel.fielddivide&&(a/=b.panel.fielddivide);d.hasOwnProperty(c)||
(d[c]=[]);0<b.chart.maxvalue&&b.chart.maxvalue<a&&(a=b.chart.maxvalue);d[c].push([f,a])})})});var f=[];"pie"==b.chart.type.value?(f.push({type:b.chart.type.value,name:a.$parent.model.title,data:[]}),angular.forEach(d,function(a,b){var c=0;angular.forEach(a,function(a){c+=a[1]});f[0].data.push([b,c])})):angular.forEach(d,function(a,c){var d={};d.name=c;d.type=b.chart.type.value;a.sort(function(a,b){return a[0]-b[0]});d.data=a;f.push(d)});return f}b.panel.fieldname.split(";");b.panel.fieldvalue.split(";");
a.reloadIt=function(){a.$parent.changeReloading(!0);c.get(b,b.path,b.query).then(function(b){b=h(b);for(var c=a.chartObj,f=b.length,d=0,e=c.series.length;d<e;d++)d<f?c.series[d].update(b[d],!0):c.series[d]&&c.series[d].remove(!1);for(d=0;d<f;d++)c.addSeries(b[d],!0);a.$parent.changeReloading(!1)},function(a){})};e=h(d);d&&("pie"==b.chart.type.value?(a.chartConfig={chart:{type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.$parent.model.title,style:{display:"none"}},
plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:0,dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},showInLegend:!1}},series:e},b.chart.ccc&&(d=[],d=b.chart.ccc.split(","),a.chartConfig.hasOwnProperty("colors")||(a.chartConfig.colors=[]),a.chartConfig.colors=d),b.chart.ddd&&(a.chartConfig.chart.options3d={enabled:!0,alpha:45,beta:0},a.chartConfig.plotOptions.pie.depth=35),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||
(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&(a.chartConfig.size.width=b.chart.size.width),0<parseInt(b.chart.size.height)&&(a.chartConfig.size.height=b.chart.size.height)),b.chart.legend&&b.chart.legend.enabled&&1==b.chart.legend.enabled&&(a.chartConfig.plotOptions.pie.showInLegend=b.chart.legend.enabled,a.chartConfig.plotOptions.pie.dataLabels.enabled=!1)):(a.chartConfig={chart:{type:b.chart.type.value},title:{text:a.$parent.model.title,style:{display:"none"}},xAxis:{type:"datetime"},
yAxis:{title:{text:null},min:0},plotOptions:{column:{}},legend:{enabled:!1,borderWidth:0},series:e},b.chart.ccc&&(d=[],d=b.chart.ccc.split(","),a.chartConfig.hasOwnProperty("colors")||(a.chartConfig.colors=[]),a.chartConfig.colors=d),b.chart.sss&&(d=b.chart.type.value,a.chartConfig.plotOptions[d]={},a.chartConfig.plotOptions[d].stacking=b.chart.ppp?"percent":"normal"),b.chart.ddd&&(a.chartConfig.chart.options3d={enabled:!0,alpha:15,beta:10,depth:50,viewDistance:30},a.chartConfig.plotOptions.column.depth=
25,a.chartConfig.chart.margin=60),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&(a.chartConfig.size.width=b.chart.size.width),0<parseInt(b.chart.size.height)&&(a.chartConfig.size.height=b.chart.size.height)),b.chart.legend&&(b.chart.legend.align&&(a.chartConfig.legend.align=b.chart.legend.align),b.chart.legend.enabled&&(a.chartConfig.legend.enabled=b.chart.legend.enabled),b.chart.legend.layout&&(a.chartConfig.legend.layout=b.chart.legend.layout)),
b.chart.yaxis&&b.chart.yaxis.title&&0<b.chart.yaxis.title.length&&(a.chartConfig.yAxis.title.text=b.chart.yaxis.title)))}).controller("querycapEditController",function(a,b,d,c){a.charts=[{id:1,label:"Spline",value:"spline"},{id:2,label:"Line",value:"line"},{id:3,label:"Area spline",value:"areaspline"},{id:4,label:"Bar",value:"bar"},{id:5,label:"Scatter",value:"scatter"},{id:6,label:"Pie",value:"pie"},{id:7,label:"Column",value:"column"}];a.legend_align=[{name:"center",value:"center"},{name:"right",
value:"right"},{name:"left",value:"left"}];a.legend_layout=[{name:"horizontal",value:"horizontal"},{name:"vertical",value:"vertical"}];a.updateDebugUrl=function(){if(a.config&&a.config.query&&a.config.path&&a.config.db){var b=a.config.query,d=c.getProfile("timerange"),b=b.replace(/\$fromts/g,1E3*d.from.getTime()+"u"),b=b.replace(/\$tots/g,1E3*d.to.getTime()+"u");a.debug="curl -v -X GET '"+(a.config.path+"?u="+a.config.db.user+"&p="+a.config.db.password+"&db="+a.config.db.name+"&q="+b)+"'\n";a.parsingStatus=
"ok";a.parsingColorClass="green"}};a.updateDebugUrl()});angular.module("adf.widgets.linklist",["adf.provider"]).config(function(a){a.widget("linklist",{title:"URL Links",group:"Tools",name:"linklist",description:"Display a list of links",controller:"linklistCtrl",controllerAs:"list",templateUrl:"js/widgets/linklist/linklist.html",edit:{templateUrl:"js/widgets/linklist/edit.html",reload:!1,controller:"linklistEditCtrl"}})}).controller("linklistCtrl",function(a,b){b.links||(b.links=[]);this.links=b.links}).controller("linklistEditCtrl",function(a){function b(){a.config.links||
(a.config.links=[]);return a.config.links}a.addLink=function(){b().push({})};a.removeLink=function(a){b().splice(a,1)}});angular.module("homer.widgets.adminuser",["adf.provider"]).value("adminuserServiceUrl","api/v1/admin/user").config(function(a){a.widget("adminuser",{title:"Admin User",group:"Admin",name:"adminuser",description:"Manage Local Users",templateUrl:"js/widgets/adminuser/adminuser.html",controller:"adminuserCtrl",resolve:{users:function(a,d){return a.get()}},edit:{templateUrl:"js/widgets/adminuser/edit.html"}})}).service("adminuserService",function(a,b,d){return{get:function(){var c=a.defer();b.get(d+"/get").success(function(a){a&&
a.data?c.resolve(a.data):c.reject()}).error(function(){c.reject()});return c.promise},save:function(c){var e=a.defer();console.log(c);b.post(d+"/new",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},update:function(c){var e=a.defer();console.log(c);b.post(d+"/edit",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},"delete":function(c){var e=a.defer();b["delete"](d+"/delete/"+
c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise}}}).controller("adminuserCtrl",function(a,b,d,c,e,h,k){a.showtable=!0;a.inactiveTab=!1;a.activeTab=!0;a.editTab=!1;a.newTab=!1;a.activeMainTab=!0;a.disabled=!1;a.removeUserTab=function(b){a.activeTab=!0;a.activeMainTab=!0;a.editTab=!1;a.newTab=!1;a.activeNewTab=!1;a.tabShown=!0};a.newUser=function(){a.newuser=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=!1;a.newTab=!0;a.activeMainTab=!1;
a.tabShown=!1};a.editUser=function(){a.newuser=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=!0;a.newTab=!1;a.activeMainTab=!1;a.tabShown=!1};a.addNewUser=function(){console.log("NEW USER");a.errorNewUserShow=!1;a.removeUserTab();var b={};b.param={email:a.newuser.email,firstname:a.newuser.firstname,grp:a.newuser.grp,lastname:a.newuser.lastname,password:a.newuser.password1,username:a.newuser.username,department:a.newuser.department,active:a.newuser.active};c.save(b).then(function(b){console.log("ZZZZZZZZZZZZ");
a.gridOptions.data.length=0;e(function(){a.gridOptions.data=b})})};a.doEditUser=function(){console.log("Edit USER");a.editTab=!1;a.newTab=!1;a.activeNewTab=!1;a.activeMainTab=!0;a.activeTab=!0;a.errorEditUserShow=!1;a.tabShown=!0;var b={};b.param={email:a.user.email,firstname:a.user.firstname,gid:a.user.gid,grp:a.user.grp,lastname:a.user.lastname,password:a.user.password1,username:a.user.username,department:a.user.department,active:a.user.active,uid:a.user.uid};c.update(b).then(function(b){a.gridOptions.data.length=
0;e(function(){a.gridOptions.data=b})})};a.doDeleteUser=function(){console.log("Delete USER");k.swal({title:"Are you sure?",text:"Your will not be able to recover this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(b){b&&(a.editTab=!1,a.newTab=!1,a.activeNewTab=!1,a.activeMainTab=!0,a.activeTab=!0,a.tabShown=!0,c["delete"](a.user.uid).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=
b})}),a.removeAlarmTab())})};a.gridOptions={showFooter:!1,enableSorting:!0,enableFiltering:!0,multiSelect:!1,enableRowSelection:!1,enableSelectAll:!1,enableRowHeaderSelection:!1,rowTemplate:'<div ng-click="grid.appScope.onDblClickRow(row)" ng-dblclick="grid.appScope.onDblClickRow(row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',noUnselect:!0};a.gridOptions.rowIdentity=
function(a){return a.id};a.gridOptions.onRegisterApi=function(b){a.gridApi=b};a.onDblClickRow=function(b){a.editTab=!0;a.activeTab=!1;a.newTab=!1;a.user=b.entity};a.Delete=function(b){b=a.gridOptions.data.indexOf(b.entity);a.gridOptions.data.splice(b,1)};a.gridOptions.columnDefs=[{name:"uid",enableCellEdit:!1,width:50},{name:"gid",width:50},{name:"username",displayName:"username"},{name:"firstname",displayName:"Firstname"},{name:"lastname",displayName:"Lastname"},{name:"email",displayName:"Email"},
{name:"department",displayName:"Department"},{name:"regdate",displayName:"Registered",type:"date",cellFilter:'date:"yyyy-MM-dd"'},{name:"lastvisit",displayName:"Last",type:"date",cellFilter:'date:"yyyy-MM-dd"'},{name:"active",displayName:"Active",type:"boolean",width:50}];console.log("ADM-ROW_USER");console.log(b);a.gridOptions.data=b}).controller("userSelectDialogCtrl",function(a,b,d,c){b.user=c;b.hstep=1;b.mstep=15;b.options={hstep:[1,2,3],mstep:[1,5,10,15,25,30]};b.$watch("timerange.from",function(c,
d){a.info("Date Changed: "+c);b.opened=!1});b.open=function(a,c){a.preventDefault();a.stopPropagation();b[c]=!0};b.done=function(){d.close(b.timerange)}});angular.module("homer.widgets.alarm",["adf.provider"]).value("alarmServiceUrl","api/v1/alarm/config").config(function(a){a.widget("alarm",{title:"Alarm Settings",group:"Admin",name:"alarm",description:"Configure Alarm Triggers",templateUrl:"js/widgets/alarm/alarm.html",controller:"alarmCtrl",resolve:{alarms:function(a,d){return a.get()}},edit:{templateUrl:"js/widgets/alarm/edit.html"}})}).service("alarmService",function(a,b,d){return{get:function(){var c=a.defer();b.get(d+"/get").success(function(a){a&&
a.data?c.resolve(a.data):c.reject()}).error(function(){c.reject()});return c.promise},save:function(c){var e=a.defer();console.log(c);b.post(d+"/new",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},update:function(c){var e=a.defer();console.log(c);b.post(d+"/edit",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},"delete":function(c){var e=a.defer();b["delete"](d+"/delete/"+
c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise}}}).controller("alarmCtrl",function(a,b,d,c,e,h,k){a.showtable=!0;a.inactiveTab=!1;a.activeTab=!0;a.editTab=!1;a.newTab=!1;a.activeMainTab=!0;a.disabled=!1;a.removeAlarmTab=function(b){a.activeTab=!0;a.activeMainTab=!0;a.editTab=!1;a.newTab=!1;a.activeNewTab=!1;a.tabShown=!0};a.newAlarm=function(){a.newalarm=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=!1;a.newTab=!0;a.activeMainTab=!1;
a.tabShown=!1};a.editAlarm=function(){a.newalarm=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=!0;a.newTab=!1;a.activeMainTab=!1;a.tabShown=!1};a.addNewAlarm=function(){console.log("NEW Alarm");a.errorNewAlarmShow=!1;a.removeAlarmTab();var b={};b.param={email:a.newalarm.email,name:a.newalarm.name,startdate:a.newalarm.startdate,stopdate:a.newalarm.stopdate,type:a.newalarm.type,value:a.newalarm.value,notify:a.newalarm.notify,active:a.newalarm.active};c.save(b).then(function(b){a.gridOptions.data.length=
0;e(function(){a.gridOptions.data=b})})};a.doEditAlarm=function(){console.log("Edit USER");a.editTab=!1;a.newTab=!1;a.activeNewTab=!1;a.activeMainTab=!0;a.activeTab=!0;a.errorEditAlarmShow=!1;a.tabShown=!0;var b=a.recalarm.id;console.log(a.recalarm);console.log(a.recalarm.value);var f={};f.param={email:a.recalarm.email,name:a.recalarm.name,startdate:a.recalarm.startdate,stopdate:a.recalarm.stopdate,value:a.recalarm.value,type:a.recalarm.type,notify:a.recalarm.notify,active:a.recalarm.active,id:b};
console.log(f);c.update(f).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=b})})};a.doDeleteAlarm=function(){console.log("Delete USER");k.swal({title:"Are you sure?",text:"Your will not be able to recover this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(b){b&&(console.log("DELEEEEEEEEEEEEEEEEEE"),a.editTab=!1,a.newTab=!1,a.activeNewTab=!1,a.activeMainTab=!0,a.activeTab=
!0,a.tabShown=!0,c["delete"](a.recalarm.id).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=b})}),a.removeAlarmTab())})};a.gridOptions={showFooter:!1,enableSorting:!0,enableFiltering:!0,multiSelect:!1,enableRowSelection:!1,enableSelectAll:!1,enableRowHeaderSelection:!1,rowTemplate:'<div ng-click="grid.appScope.onDblClickRow(row)" ng-dblclick="grid.appScope.onDblClickRow(row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',
noUnselect:!0};a.gridOptions.rowIdentity=function(a){return a.id};a.gridOptions.onRegisterApi=function(b){a.gridApi=b};a.onDblClickRow=function(b){a.editTab=!0;a.activeTab=!1;a.newTab=!1;a.recalarm=b.entity};a.Delete=function(b){b=a.gridOptions.data.indexOf(b.entity);a.gridOptions.data.splice(b,1)};a.gridOptions.columnDefs=[{name:"id",enableCellEdit:!1,width:50},{name:"name",displayName:"Name"},{name:"startdate",displayName:"Start date",type:"date",cellFilter:'date:"yyyy-MM-dd"'},{name:"stopdate",
displayName:"Stop date",type:"date",cellFilter:'date:"yyyy-MM-dd"'},{name:"type",displayName:"Type"},{name:"value",displayName:"Value"},{name:"notify",displayName:"Notify"},{name:"email",displayName:"Email"},{name:"createdate",displayName:"Create date",type:"date",cellFilter:'date:"yyyy-MM-dd"'},{name:"active",displayName:"Active",type:"boolean",width:50}];console.log("ADM-ROW_USER");console.log(b);a.gridOptions.data=b}).controller("alarmSelectDialogCtrl",function(a,b,d,c){b.alarm=c;b.hstep=1;b.mstep=
15;b.options={hstep:[1,2,3],mstep:[1,5,10,15,25,30]};b.$watch("timerange.from",function(c,d){a.info("Date Changed: "+c);b.opened=!1});b.open=function(a,c){a.preventDefault();a.stopPropagation();b[c]=!0};b.done=function(){d.close(b.timerange)}});angular.module("homer.widgets.alarmlist",["adf.provider"]).value("alarmListServiceUrl","api/v1/alarm/list").config(function(a){a.widget("alarmlist",{title:"Alarm List",group:"Admin",name:"alarmlist",description:"Display Alarm Detections",templateUrl:"js/widgets/alarmlist/alarmlist.html",controller:"alarmListCtrl",reload:!0,resolve:{alarms:function(a,d){return a.get()}},edit:{templateUrl:"js/widgets/alarmlist/edit.html"}})}).service("alarmListService",function(a,b,d){return{get:function(){var c=a.defer();
b.get(d+"/get").success(function(a){a&&a.data?c.resolve(a.data):c.reject()}).error(function(){c.reject()});return c.promise},save:function(c){var e=a.defer();console.log(c);b.post(d+"/new",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},update:function(c){var e=a.defer();console.log(c);b.post(d+"/edit",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},"delete":function(c){var e=
a.defer();b["delete"](d+"/delete/"+c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise}}}).controller("alarmListCtrl",["$scope","alarms","dialogs","alarmListService","$timeout","$window","SweetAlert",homer.modules.core.services.profile,"eventbus","$location",function(a,b,d,c,e,h,k,g,f,l){a.getBkgColorTable=function(a){var b="#EDFBFF";1==a&&(b="#FF8080");return{"background-color":b}};console.log(g);a.gridListOptions={showFooter:!1,enableSorting:!0,
enableFiltering:!0,multiSelect:!1,enableRowSelection:!1,enableSelectAll:!1,enableRowHeaderSelection:!1,rowTemplate:'<div ng-style="row.isSelected && {} || grid.appScope.getBkgColorTable(row.entity.status)"><div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell></div></div>',noUnselect:!0};a.gridListOptions.rowIdentity=function(a){return a.id};a.gridListOptions.onRegisterApi=
function(b){a.gridApi=b};a.onDblClickRow=function(a){console.log("Double click",a);if(1==a.entity.status){a.entity.status=0;var b={};b.param={id:a.entity.id,status:0};console.log(b);c.update(b).then(function(b){a.entity.status=0})}};a.showAlarm=function(a,b){console.log("SHOW IT");var c=1E3*a.entity.alarm_ts,d=new Date((new Date(c)).setMinutes((new Date(c)).getMinutes()-5)),c=new Date((new Date(c)).setMinutes((new Date(c)).getMinutes()+5)),d={from:d,to:c};console.log(d);f.broadcast(homer.modules.pages.events.setTimeRange,
d);d={source_ip:a.entity.source_ip};g.setProfile("transaction",{call:!0,registration:!1,rest:!1});g.setProfile("search",d);l.path("/result")};a.deleteAlarm=function(a,b){console.log("Delete item",a);if(1==a.entity.status){a.entity.status=0;var f={};f.param={id:a.entity.id,status:0};console.log(f);c.update(f).then(function(b){a.entity.status=0})}else a.entity.status=1,f={},f.param={id:a.entity.id,status:1},c.update(f).then(function(b){a.entity.status=1});console.log("DELETE ALARM")};a.alarmValue=function(a,
b){return 1==b.entity.status?"read":"unread"};a.showAgo=function(a,b){return Math.floor(((new Date).getTime()/1E3-b.entity.alarm_ts)/3600)};a.showDateValue=function(a,b){function c(a){return 10>a?"0"+a:a}var f=new Date(1E3*b.entity.alarm_ts);return[c(f.getFullYear()),c(f.getMonth()+1),f.getDate()].join("-")+" "+[c(f.getHours()),c(f.getMinutes()),c(f.getSeconds())].join(":")};a.Delete=function(b){b=a.gridListOptions.data.indexOf(b.entity);a.gridListOptions.data.splice(b,1)};a.gridListOptions.columnDefs=
[{name:"id",enableCellEdit:!1,width:50},{name:"type",displayName:"Type"},{name:"total",displayName:"Total"},{name:"source_ip",displayName:"Source IP"},{name:"description",displayName:"Description"},{name:"create_date",field:"alarm_ts",displayName:"Create date",type:"date",cellTemplate:'<div  ng-click="grid.appScope.showAlarm(row, $event)" class="ui-grid-cell-contents"><span class="navText">{{grid.appScope.showDateValue(grid, row)}}</span></div>'},{name:"ago",displayName:"Age Hours",field:"alarm_ts",
width:150,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope.showAgo(grid, row)}}</div>'},{name:"status",displayName:"Status",type:"boolean",width:70,cellTemplate:'<button  ng-click="grid.appScope.deleteAlarm(row, $event)" class="btn btn-normal btn-danger">{{grid.appScope.alarmValue(grid, row)}}</button>'}];console.log("ADM-ROW_USER");a.gridListOptions.data=b}]);angular.module("homer.widgets.adminalias",["adf.provider"]).value("adminaliasServiceUrl","api/v1/admin/alias").config(function(a){a.widget("adminalias",{title:"Admin Alias",group:"Admin",name:"adminalias",description:"Manage IP:PORT Aliases",templateUrl:"js/widgets/adminalias/adminalias.html",controller:"adminaliasCtrl",resolve:{aliases:function(a,d){return a.get()}},edit:{templateUrl:"js/widgets/adminalias/edit.html"}})}).service("adminaliasService",function(a,b,d){return{get:function(){var c=a.defer();
b.get(d+"/get").success(function(a){a&&a.data?c.resolve(a.data):c.reject()}).error(function(){c.reject()});return c.promise},save:function(c){var e=a.defer();console.log(c);b.post(d+"/new",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},update:function(c){var e=a.defer();console.log(c);b.post(d+"/edit",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},"delete":function(c){var e=
a.defer();b["delete"](d+"/delete/"+c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise}}}).controller("adminaliasCtrl",function(a,b,d,c,e,h,k){a.showtable=!0;a.inactiveTab=!1;a.activeTab=!0;a.editTab=!1;a.newTab=!1;a.activeMainTab=!0;a.disabled=!1;a.removeAliasTab=function(b){a.activeTab=!0;a.activeMainTab=!0;a.editTab=!1;a.newTab=!1;a.activeNewTab=!1;a.tabShown=!0};a.newAlias=function(){a.newalias=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=
!1;a.newTab=!0;a.activeMainTab=!1;a.tabShown=!1};a.editAlias=function(){a.newalias=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=!0;a.newTab=!1;a.activeMainTab=!1;a.tabShown=!1};a.addNewAlias=function(){a.errorNewAliasShow=!1;a.removeAliasTab();var b={};b.param={gid:10,ip:a.newalias.ip,port:a.newalias.port,capture_id:a.newalias.capture_id,alias:a.newalias.alias,status:a.newalias.status};c.save(b).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=b})})};a.doEditAlias=function(){console.log("Edit ALIAS");
a.editTab=!1;a.newTab=!1;a.activeNewTab=!1;a.activeMainTab=!0;a.activeTab=!0;a.errorEditAliasShow=!1;a.tabShown=!0;var b={};b.param={gid:10,ip:a.arec.ip,port:a.arec.port,capture_id:a.arec.capture_id,alias:a.arec.alias,status:a.arec.status,id:a.arec.id};c.update(b).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=b})})};a.doDeleteAlias=function(){console.log("Delete ALIAS");k.swal({title:"Are you sure?",text:"Your will not be able to recover this!",type:"warning",showCancelButton:!0,
confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(b){b&&(a.editTab=!1,a.newTab=!1,a.activeNewTab=!1,a.activeMainTab=!0,a.activeTab=!0,a.tabShown=!0,c["delete"](a.arec.id).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=b})}),a.removeAliasTab())})};a.gridOptions={showFooter:!1,enableSorting:!0,enableFiltering:!0,multiSelect:!1,enableRowSelection:!1,enableSelectAll:!1,enableRowHeaderSelection:!1,rowTemplate:'<div ng-click="grid.appScope.onDblClickRow(row)" ng-dblclick="grid.appScope.onDblClickRow(row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',
noUnselect:!0};a.gridOptions.rowIdentity=function(a){return a.id};a.gridOptions.onRegisterApi=function(b){a.gridApi=b};a.onDblClickRow=function(b){a.editTab=!0;a.activeTab=!1;a.newTab=!1;a.arec=b.entity};a.Delete=function(b){b=a.gridOptions.data.indexOf(b.entity);a.gridOptions.data.splice(b,1)};a.gridOptions.columnDefs=[{name:"id",enableCellEdit:!1,width:50},{name:"alias",displayName:"Alias"},{name:"gid",width:50},{name:"ip",displayName:"IP"},{name:"port",displayName:"Port"},{name:"capture_id",displayName:"Capture ID"},
{name:"status",displayName:"status"},{name:"created",displayName:"Created",type:"date",cellFilter:'date:"yyyy-MM-dd"'}];a.gridOptions.data=b});angular.module("homer.widgets.adminnode",["adf.provider"]).value("adminnodeServiceUrl","api/v1/admin/node").config(function(a){a.widget("adminnode",{title:"Admin Node",group:"Admin",name:"adminnode",description:"Manage Database Nodes",templateUrl:"js/widgets/adminnode/adminnode.html",controller:"adminnodeCtrl",resolve:{nodes:function(a,d){return a.get()}},edit:{templateUrl:"js/widgets/adminnode/edit.html"}})}).service("adminnodeService",function(a,b,d){return{get:function(){var c=a.defer();b.get(d+
"/get").success(function(a){a&&a.data?c.resolve(a.data):c.reject()}).error(function(){c.reject()});return c.promise},save:function(c){var e=a.defer();console.log(c);b.post(d+"/new",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},update:function(c){var e=a.defer();console.log(c);b.post(d+"/edit",c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise},"delete":function(c){var e=a.defer();
b["delete"](d+"/delete/"+c).success(function(a){a&&a.data?e.resolve(a.data):e.reject()}).error(function(){e.reject()});return e.promise}}}).controller("adminnodeCtrl",function(a,b,d,c,e,h,k){a.showtable=!0;a.inactiveTab=!1;a.activeTab=!0;a.editTab=!1;a.newTab=!1;a.activeMainTab=!0;a.disabled=!1;a.removeNodeTab=function(b){a.activeTab=!0;a.activeMainTab=!0;a.editTab=!1;a.newTab=!1;a.activeNewTab=!1;a.tabShown=!0};a.newNode=function(){a.newnode=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=!1;a.newTab=
!0;a.activeMainTab=!1;a.tabShown=!1};a.editNode=function(){a.newnode=[];a.activeTab=!1;a.activeNewTab=!0;a.editTab=!0;a.newTab=!1;a.activeMainTab=!1;a.tabShown=!1};a.addNewNode=function(){console.log("NEW NODE");a.errorNewNodeShow=!1;a.removeNodeTab();var b={};b.param={host:a.newnode.host,dbname:a.newnode.dbname,dbport:a.newnode.dbport,dbusername:a.newnode.dbusername,dbpassword:a.newnode.dbpassword,dbtables:a.newnode.dbtables,name:a.newnode.name,status:a.newnode.status};c.save(b).then(function(b){console.log("ZZZZZZZZZZZZ");
a.gridOptions.data.length=0;e(function(){a.gridOptions.data=b})})};a.doEditNode=function(){console.log("Edit NODE");a.editTab=!1;a.newTab=!1;a.activeNewTab=!1;a.activeMainTab=!0;a.activeTab=!0;a.errorEditNodeShow=!1;a.tabShown=!0;var b={};b.param={host:a.noderec.host,dbname:a.noderec.dbname,dbport:a.noderec.dbport,dbusername:a.noderec.dbusername,dbpassword:a.noderec.dbpassword,dbtables:a.noderec.dbtables,name:a.noderec.name,status:a.noderec.status,id:a.noderec.id};c.update(b).then(function(b){a.gridOptions.data.length=
0;e(function(){a.gridOptions.data=b})})};a.doDeleteNode=function(){console.log("Delete NODE");k.swal({title:"Are you sure?",text:"Your will not be able to recover this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(b){b&&(a.editTab=!1,a.newTab=!1,a.activeNewTab=!1,a.activeMainTab=!0,a.activeTab=!0,a.tabShown=!0,c["delete"](a.noderec.id).then(function(b){a.gridOptions.data.length=0;e(function(){a.gridOptions.data=
b})}),a.removeNodeTab())})};a.gridOptions={showFooter:!1,enableSorting:!0,enableFiltering:!0,multiSelect:!1,enableRowSelection:!1,enableSelectAll:!1,enableRowHeaderSelection:!1,rowTemplate:'<div ng-click="grid.appScope.onDblClickRow(row)" ng-dblclick="grid.appScope.onDblClickRow(row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',noUnselect:!0};a.gridOptions.rowIdentity=
function(a){return a.id};a.gridOptions.onRegisterApi=function(b){a.gridApi=b};a.onDblClickRow=function(b){a.editTab=!0;a.activeTab=!1;a.newTab=!1;console.log(b.entity);a.noderec=b.entity};a.Delete=function(b){b=a.gridOptions.data.indexOf(b.entity);a.gridOptions.data.splice(b,1)};a.gridOptions.columnDefs=[{name:"id",enableCellEdit:!1,width:50},{name:"name",displayName:"Name"},{name:"host",displayName:"host"},{name:"dbname",displayName:"DB Name"},{name:"dbport",displayName:"DB Port"},{name:"dbusername",
displayName:"DB User"},{name:"dbpassword",displayName:"DB Password",cellTemplate:'<div  class="ui-grid-cell-contents"><span class="navText">******</span></div>'},{name:"dbtables",displayName:"DB Tables"},{name:"status",displayName:"status"}];console.log("ADM-ROW_ALIAS");console.log(b);a.gridOptions.data=b});angular.module("homer.widgets.quicksearch",["adf.provider"]).config(function(a){a.widget("quicksearch",{title:"Search Form Builder",group:"Search",name:"quicksearch",description:"Display Search Form component",templateUrl:"js/widgets/quicksearch/quicksearch.html",controller:"quicksearchCtrl",controllerAs:"qsearch",edit:{templateUrl:"js/widgets/quicksearch/edit.html",controller:"quicksearchEditCtrl"}})}).controller("quicksearchCtrl",["$scope","config","$location",homer.modules.core.services.profile,
"$log",homer.modules.core.services.search,function(a,b,d,c,e,h){c.profileScope.search&&c.profileScope.search instanceof Array&&(c.profileScope.search={});a.newObject=c.profileScope.search;a.newTransaction=c.profileScope.transaction;a.newResult=c.profileScope.result;a.newNode=c.profileScope.node;b.fields||(b.fields=[{name:"from_user",selection:"From"},{name:"to_user",selection:"To"},{name:"callid",selection:"Call-ID"}],b.searchbutton=!0);this.fields=b.fields;a.toggleSearchButton=function(){a.showSearchButton=
!a.showSearchButton;b.searchbutton=!b.searchbutton};a.timerange=c.profileScope.timerange;(function(){a.$watch(function(){return c.profileScope.search},function(b,c){b!==c&&(a.newObject=b)})})();a.nullSafe=function(b){a.newObject[b]||(a.newObject[b]="")};a.processSearchForm=function(b){a.newObject instanceof Array&&(a.newObject={});c.setProfile("search",a.newObject);c.setProfile("transaction",a.newTransaction);c.setProfile("result",a.newResult);c.setProfile("node",a.newNode);b=a.newResult.restype.name;
"pcap"==b?a.processSearchResult(!1):"text"==b?a.processSearchResult(!0):d.path("/result")};a.clearSearchForm=function(b){c.profileScope.search={};c.setProfile("search",a.newObject)};a.processSearchResult=function(a){var b={param:{},timestamp:{}},f=c.getProfile("transaction"),d=c.getProfile("limit"),e=c.getProfile("timerange"),n=c.getProfile("search"),p=c.getProfile("node").dbnode;b.param.transaction={};b.param.limit=d;b.param.search=n;b.param.node=p;b.timestamp.from=e.from.getTime();b.timestamp.to=
e.to.getTime();angular.forEach(f.transaction,function(a,c){b.param.transaction[a.name]=!0});var u=(new Date).getTime();h.makePcapTextData(b,a).then(function(b){var c="HOMER5_"+u+".pcap",f="application/pcap";a&&(c="HOMER5_"+u+".txt",f="attacment/text;charset=utf-8");b=new Blob([b],{type:f});saveAs(b,c)})};a.type_transaction=[{name:"call",value:"CALLS"},{name:"registration",value:"REGISTRATIONS"},{name:"rest",value:"OTHER"}];a.type_result=[{name:"table",value:"TABLE"},{name:"pcap",value:"PCAP"},{name:"text",
value:"TEXT"}];a.db_node_selected=[];a.db_node=[{name:"localhost",id:"localhost"}];h.loadNode().then(function(b){a.db_node=b});a.newResult.restype=a.type_result[0];a.newNode.node=a.db_node[0];a.type_method_selected=[];a.type_method=[{id:1,value:"INVITE",checked:!1},{id:2,value:"REGISTER",checked:!1},{id:3,value:"BYE",checked:!1},{id:4,value:"CANCEL",checked:!1},{id:5,value:"OPTIONS",checked:!1},{id:6,value:"ACK",checked:!1},{id:7,value:"PRACK",checked:!1},{id:8,value:"SUBSCRIBE",checked:!1},{id:9,
value:"NOTIFY",checked:!1},{id:10,value:"PUBLISH",checked:!1},{id:11,value:"INFO",checked:!1},{id:12,value:"REFER",checked:!1},{id:13,value:"MESSAGE",checked:!1},{id:14,value:"UPDATE",checked:!1},{id:15,value:"1xx",checked:!1},{id:16,value:"2xx",checked:!1},{id:17,value:"3xx",checked:!1},{id:18,value:"4xx",checked:!1},{id:19,value:"5xx",checked:!1},{id:20,value:"6xx",checked:!1},{id:21,value:"",checked:!1}]}]).controller("quicksearchEditCtrl",function(a){function b(){a.config.fields||(a.config.fields=
[]);return a.config.fields}a.addField=function(){b().push({name:"default0"})};a.removeField=function(a){b().splice(a,1)};a.headers=[{name:"from_user",selection:"From User"},{name:"from_domain",selection:"From Domain"},{name:"to_user",selection:"To User"},{name:"to_domain",selection:"To Domain"},{name:"ruri_user",selection:"RURI User"},{name:"ruri_domain",selection:"RURI Domain"},{name:"callid",selection:"Call-ID"},{name:"callid_aleg",selection:"B2B CID"},{name:"custom_field1",selection:"Custom F1"},
{name:"custom_field2",selection:"Custom F2"},{name:"custom_field3",selection:"Custom F3"},{name:"contact_user",selection:"Contact User"},{name:"pid_user",selection:"PID User"},{name:"auth_user",selection:"Auth User"},{name:"user_agent",selection:"User-Agent"},{name:"method",selection:"Method"},{name:"cseq",selection:"CSeq"},{name:"reason",selection:"Reason"},{name:"msg",selection:"Message"},{name:"diversion",selection:"Diversion"},{name:"via_1",selection:"VIA"},{name:"source_ip",selection:"Source IP"},
{name:"destination_ip",selection:"Dest. IP"},{name:"source_port",selection:"Source Port"},{name:"destination_port",selection:"Dest. Port"},{name:"node",selection:"Node"},{name:"uniq",selection:"Unique"},{name:"orand",selection:"Logic OR"},{name:"proto",selection:"Protocol"},{name:"family",selection:"Family"},{name:"limit",selection:"Limit Query"},{name:"transaction",selection:"Transaction"},{name:"dbnode",selection:"DB Node"},{name:"b2b",selection:"B2B ext"},{name:"restype",selection:"Result Type"}]}).directive("ngEnter",
function(){return function(a,b,d){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(d.ngEnter)}),b.preventDefault())})}}).directive("fieldDisplay",function(a){return{scope:{fieldDisplay:"=",fieldName:"=",fieldHeaders:"="},templateUrl:"js/widgets/quicksearch/template.html",link:function(a,d,c,e){a.selectedItem={name:a.fieldName,selection:a.fieldDisplay};a.$watch("selectedItem",function(c){a.fieldDisplay=c.selection;a.fieldName=c.name},!0)}}});angular.module("adf.widgets.news",["adf.provider"]).value("newsServiceUrl","https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&callback=JSON_CALLBACK&q=").config(function(a){a.widget("news",{title:"Newsfeed",group:"Tools",name:"news",description:"Display an RSS/Atom feed",templateUrl:"js/widgets/news/news.html",controller:"newsCtrl",resolve:{feed:function(a,d){if(d.url)return a.get(d.url)}},edit:{templateUrl:"js/widgets/news/edit.html"}})}).service("newsService",function(a,b,d){return{get:function(c){var e=
a.defer();b.jsonp(d+encodeURIComponent(c)).success(function(a){a&&a.responseData&&a.responseData.feed?e.resolve(a.responseData.feed):e.reject()}).error(function(){e.reject()});return e.promise}}}).controller("newsCtrl",function(a,b){a.feed=b});var timeZoneData={"Europe/London":0,"Europe/Amsterdam":1,"America/Los_Angeles":-8,"America/New_York":-5,"Europe/Moscow":3,"Asia/Novosibirsk":6};angular.module("homer.widget.clock",["adf.provider"]).config(function(a){a.widget("clock",{title:"World Clock",group:"Tools",name:"clock",description:"Display date and time",templateUrl:"js/widgets/clock/view.html",controller:"clockController",controllerAs:"clock",config:{timePattern:"HH:mm:ss",datePattern:"YYYY-MM-DD",location:"Europe/Amsterdam",showseconds:!1},edit:{templateUrl:"js/widgets/clock/edit.html"}})}).controller("clockController",function(a,b,d){function c(a){return("0"+a).slice(-2)}function e(){a.clocks=
[];angular.forEach(a.tz,function(b){var d=new Date,f=b.offset,l=d.getTime()+6E4*d.getTimezoneOffset();d.dst()&&(f+=1);f=new Date(l+36E5*f);d=c(f.getDate())+"-"+c(f.getMonth()+1)+"-"+f.getFullYear();f=c(f.getHours())+":"+c(f.getMinutes())+":"+c(f.getSeconds());a.clocks.push({name:b.name,time:f,date:d})})}a.tz=[];d=d.location.split(",");angular.forEach(d,function(b){b=b.replace(/ /g,"");a.tz.push({offset:timeZoneData[b],name:b,update:a.config.showseconds?1E3:6E4,showseconds:a.config.showseconds?"german":
"none"})});e();var h=b(e,1E3);a.$on("$destroy",function(){b.cancel(h)})});angular.module("homer.widgets.randommsg",["adf.provider"]).config(function(a){a.widget("randommsg",{title:"Random SIP RFC",group:"Tools",name:"randommsg",description:"Display a random SIP Method definition and RFC",templateUrl:"js/widgets/randommsg/randommsg.html",controller:"randommsgCtrl",reload:!0})}).service("randommsgService",function(){var a="INVITE: Indicates a client is being invited to participate in a call session.;ACK: Confirms that the client has received a final response to an INVITE request.;BYE: Terminates a call and can be sent by either the caller or the callee.;CANCEL: Cancels any pending request.;OPTIONS: Queries the capabilities of servers.;REGISTER: Registers the address listed in the To header field with a SIP server.;PRACK: Provisional acknowledgement.;SUBSCRIBE: Subscribes for an Event of Notification from the Notifier.;NOTIFY: Notify the subscriber of a new Event.;PUBLISH: Publishes an event to the Server.;INFO: Sends mid-session information that does not modify the session state.;REFER: Asks recipient to issue SIP request (call transfer.);MESSAGE: Transports instant messages using SIP.;UPDATE: Modifies the state of a session without changing the state of the dialog.".split(";"),
b="RFC3261 RFC3261 RFC3261 RFC3261 RFC3261 RFC3261 RFC3262 RFC6665 RFC6665 RFC3903 RFC6086 RFC3515 RFC3428 RFC3311".split(" ");return{get:function(){var d=Math.floor(Math.random()*a.length);return{text2:a[Math.floor(Math.random()*a.length)],text:a[d],author:b[d]}}}}).controller("randommsgCtrl",function(a,b){a.msg=b.get()});(function(){function a(a){var b={omitExtraWLInCodeBlocks:{"default":!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{"default":!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{"default":!1,describe:"Specify a prefix to generated header ids",type:"string"},headerLevelStart:{"default":!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{"default":!1,describe:"Turn on/off image dimension parsing",type:"boolean"},
simplifiedAutoLink:{"default":!1,describe:"Turn on/off GFM autolink style",type:"boolean"},literalMidWordUnderscores:{"default":!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},strikethrough:{"default":!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{"default":!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{"default":!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{"default":!0,describe:"Turn on/off GFM fenced code blocks support",
type:"boolean"},tasklists:{"default":!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{"default":!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"}};if(!1===a)return JSON.parse(JSON.stringify(b));a={};for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]["default"]);return a}function b(a,b){var d=b?"Error in "+b+" extension->":"Error in unnamed extension",e={valid:!0,error:""};c.helper.isArray(a)||(a=[a]);for(var h=0;h<a.length;++h){var k=
d+" sub-extension "+h+": ",g=a[h];if("object"!=typeof g)return e.valid=!1,e.error=k+"must be an object, but "+typeof g+" given",e;if(!c.helper.isString(g.type))return e.valid=!1,e.error=k+'property "type" must be a string, but '+typeof g.type+" given",e;var q=g.type=g.type.toLowerCase();if("language"===q&&(q=g.type="lang"),"html"===q&&(q=g.type="output"),"lang"!==q&&"output"!==q&&"listener"!==q)return e.valid=!1,e.error=k+"type "+q+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',
e;if("listener"===q){if(c.helper.isUndefined(g.listeners))return e.valid=!1,e.error=k+'. Extensions of type "listener" must have a property called "listeners"',e}else if(c.helper.isUndefined(g.filter)&&c.helper.isUndefined(g.regex))return e.valid=!1,e.error=k+q+' extensions must define either a "regex" property or a "filter" method',e;if(g.listeners){if("object"!=typeof g.listeners)return e.valid=!1,e.error=k+'"listeners" property must be an object but '+typeof g.listeners+" given",e;for(var y in g.listeners)if(g.listeners.hasOwnProperty(y)&&
"function"!=typeof g.listeners[y])return e.valid=!1,e.error=k+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+y+" must be a function but "+typeof g.listeners[y]+" given",e}if(g.filter){if("function"!=typeof g.filter)return e.valid=!1,e.error=k+'"filter" must be a function, but '+typeof g.filter+" given",e}else if(g.regex){if(c.helper.isString(g.regex)&&(g.regex=new RegExp(g.regex,"g")),!g.regex instanceof RegExp)return e.valid=!1,e.error=k+'"regex" property must either be a string or a RegExp object, but '+
typeof g.regex+" given",e;if(c.helper.isUndefined(g.replace))return e.valid=!1,e.error=k+'"regex" extensions must implement a replace string or function',e}}return e}function d(a,b){return"~E"+b.charCodeAt(0)+"E"}var c={},e={},h={},k=a(!0),g={github:{omitExtraWLInCodeBlocks:!0,prefixHeaderId:"user-content-",simplifiedAutoLink:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0},vanilla:a(!0)};c.helper={};c.extensions={};c.setOption=function(a,
b){return k[a]=b,this};c.getOption=function(a){return k[a]};c.getOptions=function(){return k};c.resetOptions=function(){k=a(!0)};c.setFlavor=function(a){if(g.hasOwnProperty(a)){a=g[a];for(var b in a)a.hasOwnProperty(b)&&(k[b]=a[b])}};c.getDefaultOptions=function(b){return a(b)};c.subParser=function(a,b){if(c.helper.isString(a)){if("undefined"==typeof b){if(e.hasOwnProperty(a))return e[a];throw Error("SubParser named "+a+" not registered!");}e[a]=b}};c.extension=function(a,d){if(!c.helper.isString(a))throw Error("Extension 'name' must be a string");
if(a=c.helper.stdExtName(a),c.helper.isUndefined(d)){if(!h.hasOwnProperty(a))throw Error("Extension named "+a+" is not registered!");return h[a]}"function"==typeof d&&(d=d());c.helper.isArray(d)||(d=[d]);var e=b(d,a);if(!e.valid)throw Error(e.error);h[a]=d};c.getAllExtensions=function(){return h};c.removeExtension=function(a){delete h[a]};c.resetExtensions=function(){h={}};c.validateExtension=function(a){a=b(a,null);return a.valid?!0:(console.warn(a.error),!1)};c.hasOwnProperty("helper")||(c.helper=
{});c.helper.isString=function(a){return"string"==typeof a||a instanceof String};c.helper.forEach=function(a,b){if("function"==typeof a.forEach)a.forEach(b);else for(var c=0;c<a.length;c++)b(a[c],c,a)};c.helper.isArray=function(a){return a.constructor===Array};c.helper.isUndefined=function(a){return"undefined"==typeof a};c.helper.stdExtName=function(a){return a.replace(/[_-]||\s/g,"").toLowerCase()};c.helper.escapeCharactersCallback=d;c.helper.escapeCharacters=function(a,b,c){b="(["+b.replace(/([\[\]\\])/g,
"\\$1")+"])";c&&(b="\\\\"+b);return a.replace(new RegExp(b,"g"),d)};c.helper.matchRecursiveRegExp=function(a,b,c,d){var e,h,g,q;q=d||"";d=-1<q.indexOf("g");c=new RegExp(b+"|"+c,q);var k=new RegExp(b,q.replace(/g/g,"")),v=[];do for(b=0;h=c.exec(a);)if(k.test(h[0]))b++||(g=h[0],e=c.lastIndex);else if(b&&!--b&&(q=h[0],h=a.slice(e,h.index),v.push([g+h+q,h]),!d))return v;while(b&&(c.lastIndex=e));return v};c.helper.isUndefined(console)&&(console={warn:function(a){alert(a)},log:function(a){alert(a)},error:function(a){throw a;
}});c.Converter=function(a){function d(a,f){if(f=f||null,c.helper.isString(a)){if(a=c.helper.stdExtName(a),f=a,c.extensions[a]){console.warn("DEPRECATION WARNING: "+a+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!");var l=c.extensions[a],g=a;"function"==typeof l&&(l=l(new c.Converter));c.helper.isArray(l)||(l=[l]);g=b(l,g);if(!g.valid)throw Error(g.error);for(g=0;g<l.length;++g)switch(l[g].type){case "lang":p.push(l[g]);
break;case "output":u.push(l[g]);break;default:throw Error("Extension loader error: Type unrecognized!!!");}return}if(c.helper.isUndefined(h[a]))throw Error('Extension "'+a+'" could not be loaded. It was either not found or is not a valid extension.');a=h[a]}"function"==typeof a&&(a=a());c.helper.isArray(a)||(a=[a]);g=b(a,f);if(!g.valid)throw Error(g.error);for(g=0;g<a.length;++g){switch(a[g].type){case "lang":p.push(a[g]);break;case "output":u.push(a[g])}if(a[g].hasOwnProperty(t))for(l in a[g].listeners)a[g].listeners.hasOwnProperty(l)&&
e(l,a[g].listeners[l])}}function e(a,b){if(!c.helper.isString(a))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof a+" given");if("function"!=typeof b)throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof b+" given");t.hasOwnProperty(a)||(t[a]=[]);t[a].push(b)}var n={},p=[],u=[],t={};(function(){a=a||{};for(var b in k)k.hasOwnProperty(b)&&(n[b]=k[b]);if("object"!=typeof a)throw Error("Converter expects the passed parameter to be an object, but "+
typeof a+" was passed instead.");for(var e in a)a.hasOwnProperty(e)&&(n[e]=a[e]);n.extensions&&c.helper.forEach(n.extensions,d)})();this._dispatch=function(a,b,c){if(t.hasOwnProperty(a))for(var d=0;d<t[a].length;++d){var f=t[a][d](a,b,this,c);f&&"undefined"!=typeof f&&(b=f)}return b};this.listen=function(a,b){return e(a,b),this};this.makeHtml=function(a){if(!a)return a;var b={gHtmlBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:p,outputModifiers:u,
converter:this};return a=a.replace(/~/g,"~T"),a=a.replace(/\$/g,"~D"),a=a.replace(/\r\n/g,"\n"),a=a.replace(/\r/g,"\n"),a="\n\n"+a+"\n\n",a=c.subParser("detab")(a,n,b),a=c.subParser("stripBlankLines")(a,n,b),c.helper.forEach(p,function(d){a=c.subParser("runExtension")(d,a,n,b)}),a=c.subParser("githubCodeBlocks")(a,n,b),a=c.subParser("hashHTMLBlocks")(a,n,b),a=c.subParser("hashHTMLSpans")(a,n,b),a=c.subParser("stripLinkDefinitions")(a,n,b),a=c.subParser("blockGamut")(a,n,b),a=c.subParser("unhashHTMLSpans")(a,
n,b),a=c.subParser("unescapeSpecialChars")(a,n,b),a=a.replace(/~D/g,"$$"),a=a.replace(/~T/g,"~"),c.helper.forEach(u,function(d){a=c.subParser("runExtension")(d,a,n,b)}),a};this.setOption=function(a,b){n[a]=b};this.getOption=function(a){return n[a]};this.getOptions=function(){return n};this.addExtension=function(a,b){d(a,b||null)};this.useExtension=function(a){d(a)};this.setFlavor=function(a){if(g.hasOwnProperty(a)){a=g[a];for(var b in a)a.hasOwnProperty(b)&&(n[b]=a[b])}};this.removeExtension=function(a){c.helper.isArray(a)||
(a=[a]);for(var b=0;b<a.length;++b){for(var d=a[b],f=0;f<p.length;++f)p[f]===d&&p[f].splice(f,1);for(;0<u.length;++f)u[0]===d&&u[0].splice(f,1)}};this.getAllExtensions=function(){return{language:p,output:u}}};c.subParser("anchors",function(a,b,d){a=d.converter._dispatch("anchors.before",a,b);var e=function(a,b,f,e,l,h,g,k){c.helper.isUndefined(k)&&(k="");a=b;b=e.toLowerCase();if(!l)if(b||(b=f.toLowerCase().replace(/ ?\n/g," ")),c.helper.isUndefined(d.gUrls[b])){if(!(-1<a.search(/\(\s*\)$/m)))return a;
l=""}else l=d.gUrls[b],c.helper.isUndefined(d.gTitles[b])||(k=d.gTitles[b]);l=c.helper.escapeCharacters(l,"*_",!1);a='<a href="'+l+'"';return""!==k&&null!==k&&(k=k.replace(/"/g,"&quot;"),k=c.helper.escapeCharacters(k,"*_",!1),a+=' title="'+k+'"'),a+(">"+f+"</a>")};return a=a.replace(/(\[((?:\[[^\]]*]|[^\[\]])*)][ ]?(?:\n[ ]*)?\[(.*?)])()()()()/g,e),a=a.replace(/(\[((?:\[[^\]]*]|[^\[\]])*)]\([ \t]*()<?(.*?(?:\(.*?\).*?)?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,e),a=a.replace(/(\[([^\[\]]+)])()()()()()/g,
e),a=d.converter._dispatch("anchors.after",a,b)});c.subParser("autoLinks",function(a,b,d){function e(a,b){var d=c.subParser("unescapeSpecialChars")(b);return c.subParser("encodeEmailAddress")(d)}a=d.converter._dispatch("autoLinks.before",a,b);var h=/\b(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+)(?=\s|$)(?!["<>])/gi,g=/(?:^|[ \n\t])([A-Za-z0-9!#$%&'*+-/=?^_`\{|}~\.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?:$|[ \n\t])/gi;return a=a.replace(/<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)>/gi,'<a href="$1">$1</a>'),
a=a.replace(/<(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,e),b.simplifiedAutoLink&&(a=a.replace(h,'<a href="$1">$1</a>'),a=a.replace(g,e)),a=d.converter._dispatch("autoLinks.after",a,b)});c.subParser("blockGamut",function(a,b,d){a=d.converter._dispatch("blockGamut.before",a,b);a=c.subParser("blockQuotes")(a,b,d);a=c.subParser("headers")(a,b,d);var e=c.subParser("hashBlock")("<hr />",b,d);return a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,e),a=a.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,
e),a=a.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,e),a=c.subParser("lists")(a,b,d),a=c.subParser("codeBlocks")(a,b,d),a=c.subParser("tables")(a,b,d),a=c.subParser("hashHTMLBlocks")(a,b,d),a=c.subParser("paragraphs")(a,b,d),d.converter._dispatch("blockGamut.after",a,b)});c.subParser("blockQuotes",function(a,b,d){return a=d.converter._dispatch("blockQuotes.before",a,b),a=a.replace(/((^[ \t]{0,3}>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,f){var e=f;return e=e.replace(/^[ \t]*>[ \t]?/gm,"~0"),e=e.replace(/~0/g,
""),e=e.replace(/^[ \t]+$/gm,""),e=c.subParser("githubCodeBlocks")(e,b,d),e=c.subParser("blockGamut")(e,b,d),e=e.replace(/(^|\n)/g,"$1  "),e=e.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c=b;return c=c.replace(/^  /gm,"~0"),c.replace(/~0/g,"")}),c.subParser("hashBlock")("<blockquote>\n"+e+"\n</blockquote>",b,d)}),a=d.converter._dispatch("blockQuotes.after",a,b)});c.subParser("codeBlocks",function(a,b,d){a=d.converter._dispatch("codeBlocks.before",a,b);a+="~0";return a=a.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,
function(a,f,e){a=f;f="\n";return a=c.subParser("outdent")(a),a=c.subParser("encodeCode")(a),a=c.subParser("detab")(a),a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,""),b.omitExtraWLInCodeBlocks&&(f=""),a="<pre><code>"+a+f+"</code></pre>",c.subParser("hashBlock")(a,b,d)+e}),a=a.replace(/~0/,""),a=d.converter._dispatch("codeBlocks.after",a,b)});c.subParser("codeSpans",function(a,b,d){return a=d.converter._dispatch("codeSpans.before",a,b),a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,
d,f){a=f;return a=a.replace(/^([ \t]*)/g,""),a=a.replace(/[ \t]*$/g,""),a=c.subParser("encodeCode")(a),b+"<code>"+a+"</code>"}),a=d.converter._dispatch("codeSpans.after",a,b)});c.subParser("detab",function(a){return a=a.replace(/\t(?=\t)/g,"    "),a=a.replace(/\t/g,"~A~B"),a=a.replace(/~B(.+?)~A/g,function(a,b){for(var c=b,d=4-c.length%4,f=0;d>f;f++)c+=" ";return c}),a=a.replace(/~A/g,"    "),a=a.replace(/~B/g,"")});c.subParser("encodeAmpsAndAngles",function(a){return a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,
"&amp;"),a.replace(/<(?![a-z\/?\$!])/gi,"&lt;")});c.subParser("encodeBackslashEscapes",function(a){return a=a.replace(/\\(\\)/g,c.helper.escapeCharactersCallback),a.replace(/\\([`*_{}\[\]()>#+-.!])/g,c.helper.escapeCharactersCallback)});c.subParser("encodeCode",function(a){return a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),c.helper.escapeCharacters(a,"*_{}[]\\",!1)});c.subParser("encodeEmailAddress",function(a){var b=[function(a){return"&#"+a.charCodeAt(0)+";"},function(a){return"&#x"+
a.charCodeAt(0).toString(16)+";"},function(a){return a}];return a="mailto:"+a,a=a.replace(/./g,function(a){if("@"===a)a=b[Math.floor(2*Math.random())](a);else if(":"!==a){var c=Math.random();a=.9<c?b[2](a):.45<c?b[1](a):b[0](a)}return a}),a='<a href="'+a+'">'+a+"</a>",a=a.replace(/">.+:/g,'">')});c.subParser("escapeSpecialCharsWithinTagAttributes",function(a){return a=a.replace(/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi,function(a){a=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return c.helper.escapeCharacters(a,
"\\`*_",!1)})});c.subParser("githubCodeBlocks",function(a,b,d){return b.ghCodeBlocks?(a=d.converter._dispatch("githubCodeBlocks.before",a,b),a+="~0",a=a.replace(/(?:^|\n)```(.*)\n([\s\S]*?)\n```/g,function(a,f,e){a=b.omitExtraWLInCodeBlocks?"":"\n";return e=c.subParser("encodeCode")(e),e=c.subParser("detab")(e),e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,""),e="<pre><code"+(f?' class="'+f+" language-"+f+'"':"")+">"+e+a+"</code></pre>",c.subParser("hashBlock")(e,b,d)}),a=a.replace(/~0/,""),a=d.converter._dispatch("githubCodeBlocks.after",
a,b)):a});c.subParser("hashBlock",function(a,b,c){return a=a.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(c.gHtmlBlocks.push(a)-1)+"K\n\n"});c.subParser("hashElement",function(a,b,c){return function(a,b){var d=b;return d=d.replace(/\n\n/g,"\n"),d=d.replace(/^\n/,""),d=d.replace(/\n+$/g,""),"\n\n~K"+(c.gHtmlBlocks.push(d)-1)+"K\n\n"}});c.subParser("hashHTMLBlocks",function(a,b,d){return a=a.replace(/\n/g,"\n\n"),a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,
c.subParser("hashElement")(a,b,d)),a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|style|section|header|footer|nav|article|aside|address|audio|canvas|figure|hgroup|output|video)\b[^\r]*?<\/\2>[ \t]*(?=\n+)\n)/gm,c.subParser("hashElement")(a,b,d)),a=a.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,c.subParser("hashElement")(a,b,d)),a=a.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,c.subParser("hashElement")(a,b,d)),
a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,c.subParser("hashElement")(a,b,d)),a.replace(/\n\n/g,"\n")});c.subParser("hashHTMLSpans",function(a,b,d){b=c.helper.matchRecursiveRegExp(a,"<code\\b[^>]*>","</code>","gi");for(var e=0;e<b.length;++e)a=a.replace(b[e][0],"~L"+(d.gHtmlSpans.push(b[e][0])-1)+"L");return a});c.subParser("unhashHTMLSpans",function(a,b,c){for(b=0;b<c.gHtmlSpans.length;++b)a=a.replace("~L"+b+"L",c.gHtmlSpans[b]);return a});c.subParser("headers",function(a,
b,d){function e(a){var b;a=a.replace(/[^\w]/g,"").toLowerCase();return d.hashLinkCounts[a]?b=a+"-"+d.hashLinkCounts[a]++:(b=a,d.hashLinkCounts[a]=1),!0===h&&(h="section"),c.helper.isString(h)?h+b:b}a=d.converter._dispatch("headers.before",a,b);var h=b.prefixHeaderId,g=isNaN(parseInt(b.headerLevelStart))?1:parseInt(b.headerLevelStart),k=b.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;return a=a.replace(b.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,
function(a,f){var h=c.subParser("spanGamut")(f,b,d),k=b.noHeaderId?"":' id="'+e(f)+'"',h="<h"+g+k+">"+h+"</h"+g+">";return c.subParser("hashBlock")(h,b,d)}),a=a.replace(k,function(a,f){var h=c.subParser("spanGamut")(f,b,d),k=b.noHeaderId?"":' id="'+e(f)+'"',p=g+1,h="<h"+p+k+">"+h+"</h"+p+">";return c.subParser("hashBlock")(h,b,d)}),a=a.replace(/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm,function(a,f,h){a=c.subParser("spanGamut")(h,b,d);h=b.noHeaderId?"":' id="'+e(h)+'"';f=g-1+f.length;f="<h"+f+h+">"+a+"</h"+
f+">";return c.subParser("hashBlock")(f,b,d)}),a=d.converter._dispatch("headers.after",a,b)});c.subParser("images",function(a,b,d){function e(a,b,f,h,g,l,k,n){k=d.gUrls;var w=d.gTitles,x=d.gDimensions;if(f=f.toLowerCase(),n||(n=""),""===h||null===h){if((""===f||null===f)&&(f=b.toLowerCase().replace(/ ?\n/g," ")),c.helper.isUndefined(k[f]))return a;h=k[f];c.helper.isUndefined(w[f])||(n=w[f]);c.helper.isUndefined(x[f])||(g=x[f].width,l=x[f].height)}b=b.replace(/"/g,"&quot;");b=c.helper.escapeCharacters(b,
"*_",!1);h=c.helper.escapeCharacters(h,"*_",!1);a='<img src="'+h+'" alt="'+b+'"';return n&&(n=n.replace(/"/g,"&quot;"),n=c.helper.escapeCharacters(n,"*_",!1),a+=' title="'+n+'"'),g&&l&&(g="*"===g?"auto":g,l="*"===l?"auto":l,a+=' width="'+g+'"',a+=' height="'+l+'"'),a+" />"}a=d.converter._dispatch("images.before",a,b);return a=a.replace(/!\[(.*?)][ ]?(?:\n[ ]*)?\[(.*?)]()()()()()/g,e),a=a.replace(/!\[(.*?)]\s?\([ \t]*()<?(\S+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(['"])(.*?)\6[ \t]*)?\)/g,
e),a=d.converter._dispatch("images.after",a,b)});c.subParser("italicsAndBold",function(a,b,c){return a=c.converter._dispatch("italicsAndBold.before",a,b),b.literalMidWordUnderscores?(a=a.replace(/(^|\s|>|\b)__(?=\S)([^]+?)__(?=\b|<|\s|$)/gm,"$1<strong>$2</strong>"),a=a.replace(/(^|\s|>|\b)_(?=\S)([^]+?)_(?=\b|<|\s|$)/gm,"$1<em>$2</em>"),a=a.replace(/(\*\*)(?=\S)([^\r]*?\S[*]*)\1/g,"<strong>$2</strong>"),a=a.replace(/(\*)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")):(a=a.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,
"<strong>$2</strong>"),a=a.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")),c.converter._dispatch("italicsAndBold.after",a,b)});c.subParser("lists",function(a,b,d){function e(a,f){d.gListLevel++;a=a.replace(/\n{2,}$/,"\n");a+="~0";var h=/\n[ \t]*\n(?!~0)/.test(a);return a=a.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+((\[(x| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(a,e,f,g,k,p,n){n=n&&""!==n.trim();a=c.subParser("outdent")(k,b,d);f="";return p&&b.tasklists&&(f=
' class="task-list-item" style="list-style-type: none;"',a=a.replace(/^[ \t]*\[(x| )?]/m,function(){var a='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return n&&(a+=" checked"),a+">"})),e||-1<a.search(/\n{2,}/)?(a=c.subParser("githubCodeBlocks")(a,b,d),a=c.subParser("blockGamut")(a,b,d)):(a=c.subParser("lists")(a,b,d),a=a.replace(/\n$/,""),a=h?c.subParser("paragraphs")(a,b,d):c.subParser("spanGamut")(a,b,d)),a="\n<li"+f+">"+a+"</li>\n"}),a=a.replace(/~0/g,
""),d.gListLevel--,f&&(a=a.replace(/\s+$/,"")),a}function h(a,b,c){var d="ul"===b?/^ {0,2}\d+\.[ \t]/gm:/^ {0,2}[*+-][ \t]/gm,f=[],g="";if(-1!==a.search(d))for(!function x(a){var f=a.search(d);-1!==f?(g+="\n\n<"+b+">"+e(a.slice(0,f),!!c)+"</"+b+">\n\n",b="ul"===b?"ol":"ul",d="ul"===b?/^ {0,2}\d+\.[ \t]/gm:/^ {0,2}[*+-][ \t]/gm,x(a.slice(f))):g+="\n\n<"+b+">"+e(a,!!c)+"</"+b+">\n\n"}(a),a=0;a<f.length;++a);else g="\n\n<"+b+">"+e(a,!!c)+"</"+b+">\n\n";return g}a=d.converter._dispatch("lists.before",
a,b);a+="~0";var g=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return d.gListLevel?a=a.replace(g,function(a,b,c){a=-1<c.search(/[*+-]/g)?"ul":"ol";return h(b,a,!0)}):(g=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,a=a.replace(g,function(a,b,c,d){a=-1<d.search(/[*+-]/g)?"ul":"ol";return h(c,a)})),a=a.replace(/~0/,""),a=d.converter._dispatch("lists.after",a,b)});c.subParser("outdent",function(a){return a=
a.replace(/^(\t|[ ]{1,4})/gm,"~0"),a.replace(/~0/g,"")});c.subParser("paragraphs",function(a,b,d){a=d.converter._dispatch("paragraphs.before",a,b);a=a.replace(/^\n+/g,"");a=a.replace(/\n+$/g,"");for(var e=a.split(/\n{2,}/g),h=[],g=e.length,k=0;g>k;k++){var q=e[k];0<=q.search(/~K(\d+)K/g)?h.push(q):0<=q.search(/\S/)&&(q=c.subParser("spanGamut")(q,b,d),q=q.replace(/^([ \t]*)/g,"<p>"),q+="</p>",h.push(q))}g=h.length;for(k=0;g>k;k++)for(;0<=h[k].search(/~K(\d+)K/);)e=d.gHtmlBlocks[RegExp.$1],e=e.replace(/\$/g,
"$$$$"),h[k]=h[k].replace(/~K\d+K/,e);return d.converter._dispatch("paragraphs.after",a,b),h.join("\n\n")});c.subParser("runExtension",function(a,b,c,d){a.filter?b=a.filter(b,d.converter,c):a.regex&&(c=a.regex,!c instanceof RegExp&&(c=new RegExp(c,"g")),b=b.replace(c,a.replace));return b});c.subParser("spanGamut",function(a,b,d){return a=d.converter._dispatch("spanGamut.before",a,b),a=c.subParser("codeSpans")(a,b,d),a=c.subParser("escapeSpecialCharsWithinTagAttributes")(a,b,d),a=c.subParser("encodeBackslashEscapes")(a,
b,d),a=c.subParser("images")(a,b,d),a=c.subParser("anchors")(a,b,d),a=c.subParser("autoLinks")(a,b,d),a=c.subParser("encodeAmpsAndAngles")(a,b,d),a=c.subParser("italicsAndBold")(a,b,d),a=c.subParser("strikethrough")(a,b,d),a=a.replace(/  +\n/g," <br />\n"),d.converter._dispatch("spanGamut.after",a,b)});c.subParser("strikethrough",function(a,b,c){return b.strikethrough&&(a=c.converter._dispatch("strikethrough.before",a,b),a=a.replace(/(?:~T){2}([^~]+)(?:~T){2}/g,"<del>$1</del>"),a=c.converter._dispatch("strikethrough.after",
a,b)),a});c.subParser("stripBlankLines",function(a){return a.replace(/^[ \t]+$/gm,"")});c.subParser("stripLinkDefinitions",function(a,b,d){return a+="~0",a=a.replace(/^ {0,3}\[(.+)]:[ \t]*\n?[ \t]*<?(\S+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=~0))/gm,function(a,e,f,h,g,k,v){return e=e.toLowerCase(),d.gUrls[e]=c.subParser("encodeAmpsAndAngles")(f),k?k+v:(v&&(d.gTitles[e]=v.replace(/"|'/g,"&quot;")),b.parseImgDimensions&&h&&g&&
(d.gDimensions[e]={width:h,height:g}),"")}),a=a.replace(/~0/,"")});c.subParser("tables",function(a,b,d){var e=function(){var a,e={};return e.th=function(a,e){var f="";return a=a.trim(),""===a?"":(b.tableHeaderId&&(f=' id="'+a.replace(/ /g,"_").toLowerCase()+'"'),a=c.subParser("spanGamut")(a,b,d),e=e&&""!==e.trim()?' style="'+e+'"':"","<th"+f+e+">"+a+"</th>")},e.td=function(a,e){var f=c.subParser("spanGamut")(a.trim(),b,d);return e=e&&""!==e.trim()?' style="'+e+'"':"","<td"+e+">"+f+"</td>"},e.ths=
function(a,b){var c="",d=0,f=[].slice.apply(a),h=[].slice.apply(b);for(d;d<f.length;d+=1)c+=e.th(f[d],h[d])+"\n";return c},e.tds=function(a,b){var c="",d=0,f=[].slice.apply(a),h=[].slice.apply(b);for(d;d<f.length;d+=1)c+=e.td(f[d],h[d])+"\n";return c},e.thead=function(a,b){var c,d=[].slice.apply(a),f=[].slice.apply(b);return c="<thead>\n",c+="<tr>\n",c+=e.ths.apply(this,[d,f]),c+="</tr>\n",c+"</thead>\n"},e.tr=function(a,b){var c,d=[].slice.apply(a),f=[].slice.apply(b);return c="<tr>\n",c+=e.tds.apply(this,
[d,f]),c+"</tr>\n"},a=function(a){var b,c,d=0;a=a.split("\n");var f=[];for(d;d<a.length;d+=1){if(b=a[d],b.trim().match(/^[|].*[|]$/)){b=b.trim();var h=[];c=a[d+1].trim();var g=[],k=0;if(c.match(/^[|][-=|: ]+[|]$/))for(g=c.substring(1,c.length-1).split("|"),k=0;k<g.length;++k)g[k]=g[k].trim(),g[k].match(/^[:][-=| ]+[:]$/)?g[k]="text-align:center;":g[k].match(/^[-=| ]+[:]$/)?g[k]="text-align:right;":g[k].match(/^[:][-=| ]+$/)?g[k]="text-align:left;":g[k]="";if(h.push("<table>"),c=b.substring(1,b.length-
1).split("|"),0===g.length)for(k=0;k<c.length;++k)g.push("text-align:left");if(h.push(e.thead.apply(this,[c,g])),b=a[++d],b.trim().match(/^[|][-=|: ]+[|]$/)){b=a[++d];for(h.push("<tbody>");b.trim().match(/^[|].*[|]$/);)b=b.trim(),h.push(e.tr.apply(this,[b.substring(1,b.length-1).split("|"),g])),b=a[++d];h.push("</tbody>");h.push("</table>");f.push(h.join("\n"));continue}b=a[--d]}f.push(b)}return f.join("\n")},{parse:a}};b.tables&&(a=d.converter._dispatch("tables.before",a,b),a=e().parse(a),a=d.converter._dispatch("tables.after",
a,b));return a});c.subParser("unescapeSpecialChars",function(a){return a=a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)})});"undefined"!=typeof module&&module.exports?module.exports=c:"function"==typeof define&&define.amd?define("showdown",function(){return c}):this.showdown=c}).call(this);angular.module("btford.markdown",["ngSanitize"]).provider("markdownConverter",function(){return{config:function(a){},$get:function(){return new showdown.Converter}}}).directive("btfMarkdown",["$sanitize","markdownConverter",function(a,b){return{restrict:"AE",link:function(d,c,e){e.btfMarkdown?d.$watch(e.btfMarkdown,function(d){d=d?a(b.makeHtml(d)):"";c.html(d)}):(d=a(b.makeHtml(c.text())),c.html(d))}}}]);angular.module("adf.widgets.markdown",["adf.provider","btford.markdown"]).config(function(a){a.widget("markdown",{title:"Markdown",group:"Tools",name:"markdown",description:"Display a Markdown widget",controller:"markdownCtrl",templateUrl:"js/widgets/markdown/markdown.html",edit:{templateUrl:"js/widgets/markdown/edit.html",reload:!1}})}).controller("markdownCtrl",function(a,b){b.content||(b.content="");a.config=b});angular.module("homer.widgets.ripesearch",["adf.provider"]).value("RIPEServiceUrl","https://stat.ripe.net/data/visibility/data.json?resource=").config(function(a){a.widget("ripesearch",{title:"RIPE DB Search",group:"Tools",name:"ripesearch",description:"Display RIPE Visibility for a given IP/AS",templateUrl:"js/widgets/ripesearch/ripesearch.html",controller:"ripeCtrl",reload:!0,resolve:{data:function(a,d){d.rscount||(d.rscount=4);if(d.location)return a.get(d.location,d.rscount)}},edit:{templateUrl:"js/widgets/ripesearch/edit.html"}})}).service("ripesearchService",
function(a,b,d){return{get:function(c,e){var h=a.defer();b.get(d+c).success(function(a){a&&"ok"===a.status?h.resolve(a):h.reject()}).error(function(){h.reject()});return h.promise}}}).controller("ripeCtrl",function(a,b,d){a.data=b;a.data.config=d});angular.module("homer.widgets.ripewhois",["adf.provider"]).value("WhoisServiceUrl","//stat.ripe.net/data/whois/data.json?resource=").config(function(a){a.widget("ripewhois",{title:"RIPE Whois Search",group:"Tools",name:"ripewhois",description:"Display RIPE WHOIS Data for a given IP/AS",templateUrl:"js/widgets/ripewhois/ripewhois.html",controller:"ripewhoCtrl",reload:!0,resolve:{data:function(a,d){if(d.location)return a.get(d.location)}},edit:{templateUrl:"js/widgets/ripewhois/edit.html"}})}).service("whoisService",
function(a,b,d){return{get:function(c){var e=a.defer();b.get(d+c).success(function(a){a&&"ok"===a.status?e.resolve(a):e.reject()}).error(function(){e.reject()});return e.promise}}}).controller("ripewhoCtrl",function(a,b,d){a.data=b});angular.module("homer.widgets.elasticap",["adf.provider","highcharts-ng","base64"]).value("localApiUrl","api/v1/").value("elasticapApiUrl","http://homer.sipcapture.org:8086").config(function(a){a.widget("elasticapChart",angular.extend({title:"Elastic Facets",group:"Charts",name:"elasticapChart",description:"Display Elasticsearch Facets",controller:"elasticapCtrl"},{templateUrl:"js/widgets/elasticap/elasticap.html",reload:!0,resolve:{sipdata:function(a,d,c){if(c.path&&c.query)return d.get(c,c.path,
c.query)}},edit:{templateUrl:"js/widgets/elasticap/edit.html",controller:"elasticapEditController"},refresh:!0}))}).service("elasticapService",function(a,b,d,c,e){return{get:function(d,k,g){var f=a.defer(),l=c.getProfile("timerange");g=g.replace(/"\$fromts"/g,l.from.getTime());g=g.replace(/"\$tots"/g,l.to.getTime());g="undefined"!==typeof d.query_string&&-1<d.query_string.indexOf('"')?g.replace(/"\$query"/g,d.query_string):g.replace(/"\$query"/g,'"'+d.query_string+'"');d.db.user&&-1===k.indexOf("@")&&
(console.log("ES: Custom HTTP authentication"),b.defaults.headers.common.Authorization="Basic "+e.encode(d.db.password?d.db.user+":"+d.db.password:d.db.user+":"));console.log("ES-URL:",k);g=JSON.parse(g);console.log("ES-QUERY",g);b.post(k,g).success(function(a){d.debugresp=JSON.stringify(a);"histogram"===d.chart.query_type?(console.log("ES: FACETS"),f.resolve(a.facets[0].entries)):"terms"===d.chart.query_type?(console.log("ES: FACET TERMS"),f.resolve(a.facets.terms.terms)):"hits"===d.chart.query_type?
(console.log("ES: HITS"),f.resolve(a.hits.hits)):f.reject()}).error(function(){console.log("ES ERROR");f.reject()});return f.promise}}}).controller("elasticapCtrl",function(a,b,d,c){function e(c){var d={},e=b.panel.fieldname.split(";"),f=b.panel.fieldvalue.split(";");angular.forEach(c,function(a){var c=a[b.panel.timefield],h=[];angular.forEach(e,function(a){h.push(a)});var l=h.join("|"),t=0;angular.forEach(f,function(e){b.panel.fieldsum?(d.hasOwnProperty(l)||(d[l]=[]),t=a[e],d[l][1]=t):(d.hasOwnProperty(l)||
(d[l]=[]),t=a[e],d[l].push([c,t]))})});var l=[];"pie"==b.chart.type.value?(l.push({type:b.chart.type.value,name:a.$parent.model.title,data:[]}),angular.forEach(d,function(a,b){var c=0;angular.forEach(a,function(a){c+=a[1]});l[0].data.push([b,c])})):angular.forEach(d,function(a,c){a.sort(function(a,b){return a[0]-b[0]});l.push({name:c,type:b.chart.type.value,data:a})});console.log("ES-SERIES-DATA:",l);return l}b.panel&&(b.panel.fieldname.split(";"),b.panel.fieldvalue.split(";"),a.reloadIt=function(){a.$parent.changeReloading(!0);
c.get(b,b.path,b.query).then(function(b){b=e(b);var c=a.chartObj;if("undefined"!==typeof c.series){for(var d=b.length,f=0,l=c.series.length;f<l;f++)f<d?c.series[f].update(b[f],!0):c.series[f]&&c.series[f].remove(!1);for(f;f<d;f++)c.addSeries(b[f],!0);a.$parent.changeReloading(!1)}},function(a){})},d&&(d=e(d),"pie"==b.chart.type.value?(a.chartConfig={chart:{type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.$parent.model.title,style:{display:"none"}},plotOptions:{pie:{allowPointSelect:!0,
cursor:"pointer",depth:0,dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},showInLegend:!1}},series:d},b.chart.ccc&&(d=[],d=b.chart.ccc.split(","),a.chartConfig.hasOwnProperty("colors")||(a.chartConfig.colors=[]),a.chartConfig.colors=d,console.log("CCOLOR-PIE:",a.chartConfig)),b.chart.ddd&&(a.chartConfig.chart.options3d={enabled:!0,alpha:45,beta:0},a.chartConfig.plotOptions.pie.depth=35),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||
(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&(a.chartConfig.size.width=b.chart.size.width),0<parseInt(b.chart.size.height)&&(a.chartConfig.size.height=b.chart.size.height)),b.chart.legend&&b.chart.legend.enabled&&1==b.chart.legend.enabled&&(a.chartConfig.plotOptions.pie.showInLegend=b.chart.legend.enabled,a.chartConfig.plotOptions.pie.dataLabels.enabled=!1)):(a.chartConfig={chart:{type:b.chart.type.value},title:{text:a.$parent.model.title,style:{display:"none"}},xAxis:{type:"datetime"},
yAxis:{title:{text:null},min:0},plotOptions:{column:{}},legend:{enabled:!1,borderWidth:0},series:d},"terms"===b.chart.query_type&&(console.log("ES-TERMS!"),a.chartConfig.xAxis.type=void 0,a.chartConfig.xAxis.categories=[],angular.forEach(d,function(b){angular.forEach(b.data,function(b){a.chartConfig.xAxis.categories.push([b[0]])})}),"undefined"!==typeof a.chartConfig.series[0]&&(a.chartConfig.series[0].colorByPoint=!0)),b.chart.ccc&&(d=[],d=b.chart.ccc.split(","),a.chartConfig.hasOwnProperty("colors")||
(a.chartConfig.colors=[]),a.chartConfig.colors=d),b.chart.sss&&(d=b.chart.type.value,a.chartConfig.plotOptions[d]={},a.chartConfig.plotOptions[d].stacking=b.chart.ppp?"percent":"normal"),b.chart.ddd&&(a.chartConfig.chart.options3d={enabled:!0,alpha:15,beta:10,depth:50,viewDistance:30},a.chartConfig.plotOptions.column.depth=25,a.chartConfig.chart.margin=60),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&(a.chartConfig.size.width=b.chart.size.width),
0<parseInt(b.chart.size.height)&&(a.chartConfig.size.height=b.chart.size.height)),b.chart.legend&&(b.chart.legend.align&&(a.chartConfig.legend.align=b.chart.legend.align),b.chart.legend.enabled&&(a.chartConfig.legend.enabled=b.chart.legend.enabled),b.chart.legend.layout&&(a.chartConfig.legend.layout=b.chart.legend.layout)),b.chart.yaxis&&b.chart.yaxis.title&&0<b.chart.yaxis.title.length&&(a.chartConfig.yAxis.title.text=b.chart.yaxis.title))))}).controller("elasticapEditController",function(a,b,d,
c){a.charts=[{id:1,label:"Spline",value:"spline"},{id:2,label:"Line",value:"line"},{id:3,label:"Area spline",value:"areaspline"},{id:4,label:"Bar",value:"bar"},{id:5,label:"Scatter",value:"scatter"},{id:6,label:"Pie",value:"pie"},{id:7,label:"Column",value:"column"}];a.query_type=[{name:"",value:""},{name:"Terms",value:"terms"},{name:"Hits",value:"hits"},{name:"Histogram",value:"histogram"}];a.query_res=[{name:"1 Minute",value:"1m"},{name:"5 Minutes",value:"5m"},{name:"15 Minutes",value:"15m"},{name:"30 Minutes",
value:"30m"},{name:"60 Minutes",value:"1h"}];a.legend_align=[{name:"center",value:"center"},{name:"right",value:"right"},{name:"left",value:"left"}];a.legend_layout=[{name:"horizontal",value:"horizontal"},{name:"vertical",value:"vertical"}];a.updateDebugUrl=function(){if(a.config&&a.config.query&&a.config.path&&a.config.db)try{JSON.parse(a.config.query);var b=c.getProfile("timerange"),d=a.config.query,d=d.replace(/"\$fromts"/g,b.from.getTime()),d=d.replace(/"\$tots"/g,b.to.getTime()),d="undefined"!==
typeof a.config_query&&-1<a.config.query_string.indexOf('"')?d.replace(/"\$query"/g,a.config.query_string):d.replace(/"\$query"/g,'"'+a.config.query_string+'"'),k=a.config.path,b="";a.config.db.user&&(b="-U "+a.config.db.user);a.config.db.password&&(b+=":"+a.config.db.password);a.debug="curl -v -X GET "+b+" '"+k+"' -d '"+d+"\n";a.parsingStatus="ok";a.parsingColorClass="green"}catch(g){a.parsingStatus="Bad parsing: ["+g.message+"]",a.parsingColorClass="red"}};a.updateDebugUrl()});angular.module("homer.widgets.elasticaggs",["adf.provider","highcharts-ng","base64"]).value("localApiUrl","api/v1/").value("elasticaggsApiUrl","http://127.0.0.1:8086").config(function(a){a.widget("elasticaggsChart",angular.extend({title:"Elastic Aggs",group:"Charts",name:"elasticaggsChart",description:"Display Elasticsearch Aggs",controller:"elasticaggsCtrl"},{templateUrl:"js/widgets/elasticaggs/elasticaggs.html",reload:!0,resolve:{sipdata:function(a,d,c){if(c.path&&c.query)return d.get(c,c.path,
c.query);c.query=JSON.stringify({size:0,aggregations:{data:{$querytype:{field:"$query",size:0}}}},null,2)}},edit:{templateUrl:"js/widgets/elasticaggs/edit.html",controller:"elasticaggsEditController"},refresh:!0}))}).service("elasticaggsService",function(a,b,d,c,e){return{get:function(d,k,g){var f=a.defer(),l=c.getProfile("timerange");g=g.replace(/"\$fromts"/g,l.from.getTime());g=g.replace(/"\$tots"/g,l.to.getTime());g="undefined"!==typeof d.query_string&&-1<d.query_string.indexOf('"')?g.replace(/"\$query"/g,
d.query_string):g.replace(/"\$query"/g,'"'+d.query_string+'"');d.chart.query_type&&(g=g.replace(/"\$querytype"/g,'"'+d.chart.query_type+'"'));d.db.user&&-1===k.indexOf("@")&&(console.log("ES: Custom HTTP authentication"),b.defaults.headers.common.Authorization="Basic "+e.encode(d.db.password?d.db.user+":"+d.db.password:d.db.user+":"));console.log("ES-URL:",k);g=JSON.parse(g);console.log("ES-QUERY",g);b.post(k,g).success(function(a){d.debugresp=JSON.stringify(a);console.log("ES-DATA:",a.aggregations);
"value_count"===d.chart.query_type?console.log("ES: AGGS COUNT"):"terms"===d.chart.query_type?console.log("ES: AGGS TERMS"):"sum"===d.chart.query_type?console.log("ES: AGGS SUM"):"sum"===d.chart.query_type?console.log("ES: AGGS SUM"):"avg"===d.chart.query_type?console.log("ES: AGGS SUM"):console.log("REJECT: unsupported type?");f.resolve(a.aggregations.data.buckets)}).error(function(){console.log("ES ERROR");f.reject()});return f.promise}}}).controller("elasticaggsCtrl",function(a,b,d,c){function e(c){var d=
{},e=b.panel.fieldname.split(";"),f=b.panel.fieldvalue.split(";");angular.forEach(c,function(a){var c=a[b.panel.timefield],h=[];angular.forEach(e,function(a){h.push(a)});var l=h.join("|"),t=0;angular.forEach(f,function(e){b.panel.fieldsum?(d.hasOwnProperty(l)||(d[l]=[]),t=a[e],d[l][1]=t):(d.hasOwnProperty(l)||(d[l]=[]),t=a[e],d[l].push([c,t]))})});var l=[];"pie"==b.chart.type.value?(l.push({type:b.chart.type.value,name:a.$parent.model.title,data:[]}),angular.forEach(d,function(a,b){var c=0;angular.forEach(a,
function(a){c+=a[1]});l[0].data.push([b,c])})):angular.forEach(d,function(a,c){a.sort(function(a,b){return a[0]-b[0]});l.push({name:c,type:b.chart.type.value,data:a})});console.log("ES-SERIES-DATA:",l);return l}console.log(b);b.panel&&(b.panel.fieldname.split(";"),b.panel.fieldvalue.split(";"),a.reloadIt=function(){a.$parent.changeReloading(!0);c.get(b,b.path,b.query).then(function(b){b=e(b);var c=a.chartObj;if("undefined"!==typeof c.series){for(var d=b.length,f=0,l=c.series.length;f<l;f++)f<d?c.series[f].update(b[f],
!0):c.series[f]&&c.series[f].remove(!1);for(f;f<d;f++)c.addSeries(b[f],!0);a.$parent.changeReloading(!1)}},function(a){})},d&&(d=e(d),"pie"==b.chart.type.value?(a.chartConfig={chart:{type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.$parent.model.title,style:{display:"none"}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:0,dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},showInLegend:!1}},
series:d},b.chart.ccc&&(d=[],d=b.chart.ccc.split(","),a.chartConfig.hasOwnProperty("colors")||(a.chartConfig.colors=[]),a.chartConfig.colors=d,console.log("CCOLOR-PIE:",a.chartConfig)),b.chart.ddd&&(a.chartConfig.chart.options3d={enabled:!0,alpha:45,beta:0},a.chartConfig.plotOptions.pie.depth=35),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&(a.chartConfig.size.width=b.chart.size.width),0<parseInt(b.chart.size.height)&&(a.chartConfig.size.height=
b.chart.size.height)),b.chart.legend&&b.chart.legend.enabled&&1==b.chart.legend.enabled&&(a.chartConfig.plotOptions.pie.showInLegend=b.chart.legend.enabled,a.chartConfig.plotOptions.pie.dataLabels.enabled=!1)):(a.chartConfig={chart:{type:b.chart.type.value},title:{text:a.$parent.model.title,style:{display:"none"}},xAxis:{type:"datetime"},yAxis:{title:{text:null},min:0},plotOptions:{column:{}},legend:{enabled:!1,borderWidth:0},series:d},"terms"===b.chart.query_type&&(console.log("ES-TERMS!"),a.chartConfig.xAxis.type=
void 0,a.chartConfig.xAxis.categories=[],angular.forEach(d,function(b){angular.forEach(b.data,function(b){a.chartConfig.xAxis.categories.push([b[0]])})}),"undefined"!==typeof a.chartConfig.series[0]&&(a.chartConfig.series[0].colorByPoint=!0)),b.chart.ccc&&(d=[],d=b.chart.ccc.split(","),a.chartConfig.hasOwnProperty("colors")||(a.chartConfig.colors=[]),a.chartConfig.colors=d),b.chart.sss&&(d=b.chart.type.value,a.chartConfig.plotOptions[d]={},a.chartConfig.plotOptions[d].stacking=b.chart.ppp?"percent":
"normal"),b.chart.ddd&&(a.chartConfig.chart.options3d={enabled:!0,alpha:15,beta:10,depth:50,viewDistance:30},a.chartConfig.plotOptions.column.depth=25,a.chartConfig.chart.margin=60),b.chart.size&&(a.chartConfig.hasOwnProperty("size")||(a.chartConfig.size={}),0<parseInt(b.chart.size.width)&&(a.chartConfig.size.width=b.chart.size.width),0<parseInt(b.chart.size.height)&&(a.chartConfig.size.height=b.chart.size.height)),b.chart.legend&&(b.chart.legend.align&&(a.chartConfig.legend.align=b.chart.legend.align),
b.chart.legend.enabled&&(a.chartConfig.legend.enabled=b.chart.legend.enabled),b.chart.legend.layout&&(a.chartConfig.legend.layout=b.chart.legend.layout)),b.chart.yaxis&&b.chart.yaxis.title&&0<b.chart.yaxis.title.length&&(a.chartConfig.yAxis.title.text=b.chart.yaxis.title))))}).controller("elasticaggsEditController",function(a,b,d,c){a.charts=[{id:1,label:"Spline",value:"spline"},{id:2,label:"Line",value:"line"},{id:3,label:"Area spline",value:"areaspline"},{id:4,label:"Bar",value:"bar"},{id:5,label:"Scatter",
value:"scatter"},{id:6,label:"Pie",value:"pie"},{id:7,label:"Column",value:"column"}];a.query_type=[{name:"Metric",value:"value_count"},{name:"Terms",value:"terms"},{name:"Stats",value:"stats"},{name:"Stats",value:"stats"},{name:"Max",value:"max"},{name:"Min",value:"min"},{name:"Avg",value:"avg"}];a.query_res=[{name:"1 Minute",value:"1m"},{name:"5 Minutes",value:"5m"},{name:"15 Minutes",value:"15m"},{name:"30 Minutes",value:"30m"},{name:"60 Minutes",value:"1h"}];a.legend_align=[{name:"center",value:"center"},
{name:"right",value:"right"},{name:"left",value:"left"}];a.legend_layout=[{name:"horizontal",value:"horizontal"},{name:"vertical",value:"vertical"}];a.updateDebugUrl=function(){if(a.config&&a.config.query&&a.config.path&&a.config.db)try{JSON.parse(a.config.query);var b=c.getProfile("timerange"),d=a.config.query,d=d.replace(/"\$fromts"/g,b.from.getTime()),d=d.replace(/"\$tots"/g,b.to.getTime()),d="undefined"!==typeof a.config_query&&-1<a.config.query_string.indexOf('"')?d.replace(/"\$query"/g,a.config.query_string):
d.replace(/"\$query"/g,'"'+a.config.query_string+'"');a.query_type&&(d=d.replace(/"\$querytype"/g,'"'+a.config.chart.query_type+'"'));var k=a.config.path,b="";a.config.db.user&&(b="-U "+a.config.db.user);a.config.db.password&&(b+=":"+a.config.db.password);a.debug="curl -v -X GET "+b+" '"+k+"' -d '"+d+"\n";a.parsingStatus="ok";a.parsingColorClass="green"}catch(g){a.parsingStatus="Bad parsing: ["+g.message+"]",a.parsingColorClass="red"}};a.updateDebugUrl()});(function(a,b){defineHomerAngularModule(b.modules.app.name,["adf","ui.router","ui.bootstrap","ui.grid","ui.grid.resizeColumns","ui.grid.autoResize","ui.grid.pagination","ui.grid.selection","oitozero.ngSweetAlert","ngAnimate","ngCookies","ngSanitize","dialogs.main","angularFileUpload","homer.modal","homer.cflow",b.modules.core.name,b.modules.structures.name,b.modules.auth.name,b.modules.admin.name,b.modules.pages.name,"adf.widgets.markdown","adf.widgets.news","adf.widgets.linklist","homer.widget.clock",
"homer.widgets.quicksearch","homer.widgets.adminuser","homer.widgets.adminalias","homer.widgets.adminnode","homer.widgets.alarm","homer.widgets.alarmlist","homer.widgets.sipcapture","homer.widgets.querycap","homer.widgets.elasticaggs","homer.widgets.randommsg"])})(angular,homer);String.prototype.hashCode=function(){var a=0,b,d,c;if(0==this.length)return a;b=0;for(c=this.length;b<c;b++)d=this.charCodeAt(b),a=(a<<5)-a+d,a|=0;return a};var DEBUG=!0;
if(!DEBUG){window.console||(window.console={});for(var methods=["log","debug","warn","info"],i=0;i<methods.length;i++)console[methods[i]]=function(){}};(function(a,b){defineHomerAngularModule(b.modules.app.name).controller("homerAppController",["$scope","$rootScope","eventbus","$state",b.modules.auth.services.authentication,"$location","dialogs",b.modules.core.services.profile,function(a,c,e,h,k,g,f,l){function m(b){a.boolDropDownAlert="boolDropDownAlert"==b?!a.boolDropDownAlert:!1;a.boolDropDownSearch="boolDropDownSearch"==b?!a.boolDropDownSearch:!1;a.boolDropDownUserMenu="boolDropDownUserMenu"==b?!a.boolDropDownUserMenu:!1;a.boolDropDownLastMenu=
"boolDropDownLastMenu"==b?!a.boolDropDownLastMenu:!1;a.boolDropDownRefreshMenu="boolDropDownRefreshMenu"==b?!a.boolDropDownRefreshMenu:!1}c.homerApp="HOMER";c.homerVersion="5.0.1 Release";console.log("HOMER INIT:",c.homerVersion);a.header="templates/empty.html";a.menu="templates/empty.html";a.ribbon="templates/empty.html";a.footer="templates/empty.html";a.shortcut="templates/empty.html";a.templateSet=!1;c.currentUser={};a.addDashBoard=function(){f.create("templates/dialogs/newdialog.html","newDashboardCtrl",
{},{key:!1,back:"static"}).result.then(function(c){"upload"!=c?(a.dashboardname=c,e.broadcast(b.modules.pages.events.newDashboardItem,c)):e.broadcast(b.modules.pages.events.dashBoardChanged,c)},function(){a.name="No name, defaulting to New"})};a.showLeftMenu=!1;a.boolLeftMenu=!1;a.boolDropDownAlert=!1;a.boolDropDownUserMenu=!1;a.boolDropDownSearch=!1;a.changeClass=function(){a.boolLeftMenu=!a.boolLeftMenu;e.broadcast("globalWidgetRecreate",1)};a.triggerDoSearch=function(){a.boolLeftMenu=!1};a.expandLeftMenu=
function(){a.boolLeftMenu=!1};a.showAlertBox=function(){m("boolDropDownAlert")};a.showSearchBox=function(){m("boolDropDownSearch")};a.showUserMenuBox=function(){m("boolDropDownUserMenu")};a.showLastMenuBox=function(){m("boolDropDownLastMenu")};a.showRefreshMenuBox=function(){m("boolDropDownRefreshMenu")};a.searchClass="btn btn-primary";a.showMenu=function(){a.showLeftMenu=!a.showLeftMenu};a.doLogout=function(){a.showLeftMenu=!1;a.dropDownUserMenuClass="";g.path(b.modules.auth.routes.logout)};a.doResetProfile=
function(){a.showLeftMenu=!1;a.dropDownUserMenuClass="";l.deleteAllProfile();console.log(l);g.path(b.modules.auth.routes.logout)};e.subscribe(b.modules.auth.events.userLoggedIn,function(b,c){a.templateSet||(a.showLeftMenu=!0,a.header="templates/header.html",a.menu="templates/left-panel.html",a.ribbon="templates/ribbon.html",a.footer="templates/footer.html",a.shortcut="templates/shortcut.html",a.templateSet=!0,""!=h.current.name&&"login"!=h.current.name&&h.go(h.current,{},{reload:!0}))});e.subscribe(b.modules.auth.events.userLoggedOut,
function(b,c){a.showLeftMenu=!1;a.templateSet&&(a.header=null,a.menu=null,a.ribbon=null,a.footer=null,a.shortcut=null,a.templateSet=!1)});e.subscribe(b.modules.pages.events.hideLeftMenu,function(b,c){a.boolLeftMenu=!0})}]).controller("HomerDatepickerCtrl",function(d,c,e,h,k,g,f,l){function m(a){d.filterIndicator=d.timerange.custom?d.timerange.custom:"From "+e("date")(d.timerange.from,"yyyy-MM-dd HH:mm:ss")+" to "+e("date")(d.timerange.to,"yyyy-MM-dd HH:mm:ss Z");a&&(d.timerange.customFrom=d.timerange.from,
d.timerange.customTo=d.timerange.to)}(new Date).setHours((new Date).getHours()-2);d.timerange=k.profileScope.timerange;var n;(function(){d.$watch(function(){return k.profileScope.timerange},function(a,b){a!==b&&(d.timerange=a)})})();d.toggleMin=function(){d.minDate=d.minDate?null:(new Date).setFullYear(2013,0,1);d.maxDate=d.maxDate?null:(new Date).setFullYear(2032,0,1)};d.toggleMin();d.dateOptions={formatYear:"yy",startingDay:1,showWeeks:!1};d.formats=["yyyy/MM/dd","yyyy-MM-dd","dd.MM.yyyy","shortDate"];
d.formatDate=d.formats[1];d.hstep=1;d.mstep=15;d.setFromNow=function(){var a=new Date((new Date).setMinutes((new Date).getMinutes()+5));d.timerange={from:new Date,to:a};k.setProfile("timerange",d.timerange);g.broadcast("globalWidgetReload",1)};d.timeWindow=!1;d.updateFrequency="";m(!0);c.setRange=function(a,b){console.log("SELECT RANGE:",b);if(d.timerange.to!=b.to||d.timerange.from!=b.from)d.timerange.to=b.to,d.timerange.from=b.from,d.timerange.custom="",k.setProfile("timerange",d.timerange),g.broadcast("globalWidgetReload",
1),m(!0)};d.toggleTimeWindow=function(){d.timeWindow=!d.timeWindow};d.isActive=function(a){return d.timerange.custom==a?!0:!1};d.isUpdatingActive=function(a){return d.updateFrequency==a?!0:!1};d.selectCustomeTime=function(){d.timerange.custom="";d.timerange.to=new Date(d.timerange.customTo);d.timerange.from=new Date(d.timerange.customFrom);k.setProfile("timerange",d.timerange);g.broadcast("globalWidgetReload",1);d.timeWindow=!1;m(!1)};d.last=function(a,b){var c=new Date((new Date).setMinutes((new Date).getMinutes()-
a));d.timerange={from:c,to:new Date,custom:b};k.setProfile("timerange",d.timerange);g.broadcast("globalWidgetReload",1);d.timeWindow=!1;m(!0)};d.next=function(a,b){var c=new Date((new Date).setMinutes((new Date).getMinutes()+a));d.timerange={from:new Date,to:c,custom:b};k.setProfile("timerange",d.timerange);g.broadcast("globalWidgetReload",1);d.timeWindow=!1;m(!0)};d.open=function(a,b){a.preventDefault();a.stopPropagation();d[b]=!0};d.setToNow=function(a){1==a?d.timerange.customFrom=new Date:d.timerange.customTo=
new Date};d.refresh=function(c,e){console.log("REFRESH:"+c);c=parseInt(c);1>c?g.broadcast("globalWidgetReload",1):(a.isDefined(n)&&d.cancelRefresh(),d.timeWindow=!1,d.activeInterval=!0,n="result"==l.current.name?f(function(){d.timerange.to.setSeconds(d.timerange.to.getSeconds()+c);k.setProfile("timerange",d.timerange);g.broadcast(b.modules.pages.events.resultSearchSubmit,"fullsearch")},1E3*c):f(function(){m(!1);d.timerange.from.setSeconds(d.timerange.from.getSeconds()+c);d.timerange.to.setSeconds(d.timerange.to.getSeconds()+
c);k.setProfile("timerange",d.timerange);g.broadcast("globalWidgetReload",1)},1E3*c),d.updateFrequency=e)};d.cancelRefresh=function(){a.isDefined(n)&&(f.cancel(n),n=void 0,d.activeInterval=!1);d.timeWindow=!1;d.updateFrequency=""};g.subscribe(b.modules.pages.events.destroyRefresh,function(a,b,c){d.cancelRefresh()});g.subscribe(b.modules.pages.events.setTimeRange,function(a,b,c){d.timerange=b;console.log("SET RANGE",d.timerange);k.setProfile("timerange",d.timerange);m(!0)})}).controller("timerangeDialogCtrl",
function(b,c,e,h){c.timerange=h;c.options={hstep:[1,2,3],mstep:[1,5,10,15,25,30]};c.$watch("timerange.from",function(a,e){b.info("Date Changed: "+a);c.opened=!1});c.setDate=function(){a.isDefined(c.timerange.from)||(c.timerange.from=new Date);a.isDefined(c.timerange.to)||(c.timerange.to=new Date)};c.setDate();c.done=function(){e.close(c.timerange)}}).config(function(a){a.useBackdrop(!0);a.useEscClose(!0);a.useCopy(!1);a.setSize("sm")}).controller("newDashboardCtrl",function(b,c,e,h){b.dashboard={name:""};
b.cancel=function(){c.dismiss("canceled")};b.hitEnter=function(c){!a.equals(c.keyCode,13)||a.equals(b.dashboard,null)||a.equals(b.dashboard,"")||b.save()};var k=b.uploader=new h({url:"api/v1/dashboard/upload"});b.save=function(){0<b.uploader.queue.length?k.uploadAll():b.nameDialog.$valid&&c.close(b.dashboard.name)};k.filters.push({name:"customFilter",fn:function(a,b){return 1>this.queue.length}});k.onCompleteAll=function(){console.info("onCompleteAll");c.close("upload")}})})(angular,homer);(function(a,b){a.module(b.modules.auth.name).run(["$rootScope","$location","$state","$stateParams",b.modules.auth.services.authorization,b.modules.auth.services.authentication,b.modules.core.services.profile,function(a,c,e,h,k,g,f,l){var m=!1,n;a.loggedIn=!1;g.session().then(function(e){e.isAuthenticated&&(0==e.isAuthenticated?c.path(b.modules.auth.routes.login):(a.loggedIn=!0,a.currentUser.name=e.name,f.getAll(),e=c.path(),"/login"!=e&&"/logout"!=e||c.path(b.modules.pages.routes.home)));a.loggedIn=
!0},function(a){console.log(a);console.log("bad result");c.path(b.modules.auth.routes.login)});a.$on("$routeChangeStart",function(a,d){var e;m&&d.originalPath!==b.modules.auth.routes.login?(m=!1,c.path(n).replace()):void 0!==d.access&&(e=k.authorize(d.access.loginRequired,d.access.permissions,d.access.permissionCheckType),e===b.modules.auth.enums.authorised.loginRequired?(m=!0,n=d.originalPath,c.path(b.modules.auth.routes.login)):e===b.modules.auth.enums.authorised.notAuthorised&&c.path(b.modules.auth.routes.notAuthorised).replace())})}])})(angular,
homer);String.prototype.hashCode=function(){var a=0,b,d,c;if(0==this.length)return a;b=0;for(c=this.length;b<c;b++)d=this.charCodeAt(b),a=(a<<5)-a+d,a|=0;return a};Date.prototype.stdTimezoneOffset=function(){var a=new Date(this.getFullYear(),0,1),b=new Date(this.getFullYear(),6,1);return Math.max(a.getTimezoneOffset(),b.getTimezoneOffset())};Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};
