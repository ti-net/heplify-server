(function(t){t.plot.plugins.push({init:function(n){function E(a){for(var b=0,c=0,h=0,e=d.series.pie.combine.color,k=[],l=0;l<a.length;++l){var f=a[l].data;t.isArray(f)&&1==f.length&&(f=f[0]);t.isArray(f)?!isNaN(parseFloat(f[1]))&&isFinite(f[1])?f[1]=+f[1]:f[1]=0:f=!isNaN(parseFloat(f))&&isFinite(f)?[1,+f]:[1,0];a[l].data=[f]}for(l=0;l<a.length;++l)b+=a[l].data[0][1];for(l=0;l<a.length;++l)f=a[l].data[0][1],f/b<=d.series.pie.combine.threshold&&(c+=f,h++,e||(e=a[l].color));for(l=0;l<a.length;++l)f=
a[l].data[0][1],(2>h||f/b>d.series.pie.combine.threshold)&&k.push(t.extend(a[l],{data:[[1,f]],color:a[l].color,label:a[l].label,angle:f*Math.PI*2/b,percent:f/(b/100)}));1<h&&k.push({data:[[1,c]],color:e,label:d.series.pie.combine.label,angle:c*Math.PI*2/b,percent:c/(b/100)});return k}function F(a,b){function m(){c.clearRect(0,0,k,l);x.children().filter(".pieLabel, .pieLabelBackground").remove()}function h(){var a=d.series.pie.shadow.left,b=d.series.pie.shadow.top,f=d.series.pie.shadow.alpha,m=1<d.series.pie.radius?
d.series.pie.radius:u*d.series.pie.radius;if(!(m>=k/2-a||m*d.series.pie.tilt>=l/2-b||10>=m)){c.save();c.translate(a,b);c.globalAlpha=f;c.fillStyle="#000";c.translate(r,y);c.scale(1,d.series.pie.tilt);for(a=1;10>=a;a++)c.beginPath(),c.arc(0,0,m,0,2*Math.PI,!1),c.fill(),m-=a;c.restore()}}function e(){function a(b,d,f){0>=b||isNaN(b)||(f?c.fillStyle=d:(c.strokeStyle=d,c.lineJoin="round"),c.beginPath(),1E-9<Math.abs(b-2*Math.PI)&&c.moveTo(0,0),c.arc(0,0,m,e,e+b/2,!1),c.arc(0,0,m,e+b/2,e+b,!1),c.closePath(),
e+=b,f?c.fill():c.stroke())}function b(){for(var a=f,c=1<d.series.pie.label.radius?d.series.pie.label.radius:u*d.series.pie.label.radius,m=0;m<q.length;++m){if(q[m].percent>=100*d.series.pie.label.threshold){var e;e=q[m];var g=a,h=m;if(0==e.data[0][1])e=!0;else{var n=d.legend.labelFormatter,p=void 0,v=d.series.pie.label.formatter,p=n?n(e.label,e):e.label;v&&(p=v(p,e));n=(g+e.angle+g)/2;g=r+Math.round(Math.cos(n)*c);n=y+Math.round(Math.sin(n)*c)*d.series.pie.tilt;x.append("<span class='pieLabel' id='pieLabel"+
h+"' style='position:absolute;top:"+n+"px;left:"+g+"px;'>"+p+"</span>");h=x.children("#pieLabel"+h);p=n-h.height()/2;n=g-h.width()/2;h.css("top",p);h.css("left",n);0<0-p||0<0-n||0>l-(p+h.height())||0>k-(n+h.width())?e=!1:(0!=d.series.pie.label.background.opacity&&(g=d.series.pie.label.background.color,null==g&&(g=e.color),e="top:"+p+"px;left:"+n+"px;",t("<div class='pieLabelBackground' style='position:absolute;width:"+h.width()+"px;height:"+h.height()+"px;"+e+"background-color:"+g+";'></div>").css("opacity",
d.series.pie.label.background.opacity).insertBefore(h)),e=!0)}if(!e)return!1}a+=q[m].angle}return!0}var f=Math.PI*d.series.pie.startAngle,m=1<d.series.pie.radius?d.series.pie.radius:u*d.series.pie.radius;c.save();c.translate(r,y);c.scale(1,d.series.pie.tilt);c.save();for(var e=f,h=0;h<q.length;++h)q[h].startAngle=e,a(q[h].angle,q[h].color,!0);c.restore();if(0<d.series.pie.stroke.width){c.save();c.lineWidth=d.series.pie.stroke.width;e=f;for(h=0;h<q.length;++h)a(q[h].angle,d.series.pie.stroke.color,
!1);c.restore()}B(c);c.restore();return d.series.pie.label.show?b():!0}if(x){var k=a.getPlaceholder().width(),l=a.getPlaceholder().height(),f=x.children().filter(".legend").children().width()||0;c=b;A=!1;u=Math.min(k,l/d.series.pie.tilt)/2;y=l/2+d.series.pie.offset.top;r=k/2;"auto"==d.series.pie.offset.left?(r=d.legend.position.match("w")?r+f/2:r-f/2,r<u?r=u:r>k-u&&(r=k-u)):r+=d.series.pie.offset.left;var q=a.getData(),f=0;do 0<f&&(u*=.95),f+=1,m(),.8>=d.series.pie.tilt&&h();while(!e()&&10>f);10<=
f&&(m(),x.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>"));a.setSeries&&a.insertLegend&&(a.setSeries(q),a.insertLegend())}}function B(a){if(0<d.series.pie.innerRadius){a.save();var b=1<d.series.pie.innerRadius?d.series.pie.innerRadius:u*d.series.pie.innerRadius;a.globalCompositeOperation="destination-out";a.beginPath();a.fillStyle=d.series.pie.stroke.color;a.arc(0,0,b,0,2*Math.PI,!1);a.fill();a.closePath();a.restore();a.save();a.beginPath();a.strokeStyle=
d.series.pie.stroke.color;a.arc(0,0,b,0,2*Math.PI,!1);a.stroke();a.closePath();a.restore()}}function H(a){C("plothover",a)}function I(a){C("plotclick",a)}function C(a,b){var m=n.offset(),h=parseInt(b.pageX-m.left);a:{for(var m=parseInt(b.pageY-m.top),e=n.getData(),k=n.getOptions(),k=1<k.series.pie.radius?k.series.pie.radius:u*k.series.pie.radius,l,f,q=0;q<e.length;++q){var g=e[q];if(g.pie.show){c.save();c.beginPath();c.moveTo(0,0);c.arc(0,0,k,g.startAngle,g.startAngle+g.angle/2,!1);c.arc(0,0,k,g.startAngle+
g.angle/2,g.startAngle+g.angle,!1);c.closePath();l=h-r;f=m-y;if(c.isPointInPath){if(c.isPointInPath(h-r,m-y)){c.restore();h={datapoint:[g.percent,g.data],dataIndex:0,series:g,seriesIndex:q};break a}}else{var p=k*Math.cos(g.startAngle),w=k*Math.sin(g.startAngle),t=k*Math.cos(g.startAngle+g.angle/4),z=k*Math.sin(g.startAngle+g.angle/4),E=k*Math.cos(g.startAngle+g.angle/2),A=k*Math.sin(g.startAngle+g.angle/2),B=k*Math.cos(g.startAngle+g.angle/1.5),C=k*Math.sin(g.startAngle+g.angle/1.5),D=k*Math.cos(g.startAngle+
g.angle),F=k*Math.sin(g.startAngle+g.angle),p=[[0,0],[p,w],[t,z],[E,A],[B,C],[D,F]];l=[l,f];f=!1;w=-1;t=p.length;for(z=t-1;++w<t;z=w)(p[w][1]<=l[1]&&l[1]<p[z][1]||p[z][1]<=l[1]&&l[1]<p[w][1])&&l[0]<(p[z][0]-p[w][0])*(l[1]-p[w][1])/(p[z][1]-p[w][1])+p[w][0]&&(f=!f);if(f){c.restore();h={datapoint:[g.percent,g.data],dataIndex:0,series:g,seriesIndex:q};break a}}c.restore()}}h=null}if(d.grid.autoHighlight)for(m=0;m<v.length;++m)e=v[m],e.auto!=a||h&&e.series==h.series||(e=e.series,null==e&&(v=[],n.triggerRedrawOverlay()),
e=G(e),-1!=e&&(v.splice(e,1),n.triggerRedrawOverlay()));h&&(m=h.series,e=G(m),-1==e?(v.push({series:m,auto:a}),n.triggerRedrawOverlay()):a||(v[e].auto=!1));x.trigger(a,[{pageX:b.pageX,pageY:b.pageY},h])}function G(a){for(var b=0;b<v.length;++b)if(v[b].series==a)return b;return-1}var D=null,x=null,d=null,u=null,r=null,y=null,A=!1,c=null,v=[];n.hooks.processOptions.push(function(a,b){b.series.pie.show&&(b.grid.show=!1,"auto"==b.series.pie.label.show&&(b.series.pie.label.show=b.legend.show?!1:!0),"auto"==
b.series.pie.radius&&(b.series.pie.radius=b.series.pie.label.show?.75:1),1<b.series.pie.tilt?b.series.pie.tilt=1:0>b.series.pie.tilt&&(b.series.pie.tilt=0))});n.hooks.bindEvents.push(function(a,b){var c=a.getOptions();c.series.pie.show&&(c.grid.hoverable&&b.unbind("mousemove").mousemove(H),c.grid.clickable&&b.unbind("click").click(I))});n.hooks.processDatapoints.push(function(a,b,c,h){a.getOptions().series.pie.show&&!A&&(A=!0,D=a.getCanvas(),x=t(D).parent(),d=a.getOptions(),a.setData(E(a.getData())))});
n.hooks.drawOverlay.push(function(a,b){if(a.getOptions().series.pie.show){var c=a.getOptions(),d=1<c.series.pie.radius?c.series.pie.radius:u*c.series.pie.radius;b.save();b.translate(r,y);b.scale(1,c.series.pie.tilt);for(var e=0;e<v.length;++e){var k=v[e].series;0>=k.angle||isNaN(k.angle)||(b.fillStyle="rgba(255, 255, 255, "+c.series.pie.highlight.opacity+")",b.beginPath(),1E-9<Math.abs(k.angle-2*Math.PI)&&b.moveTo(0,0),b.arc(0,0,d,k.startAngle,k.startAngle+k.angle/2,!1),b.arc(0,0,d,k.startAngle+k.angle/
2,k.startAngle+k.angle,!1),b.closePath(),b.fill())}B(b);b.restore()}});n.hooks.draw.push(function(a,b){a.getOptions().series.pie.show&&F(a,b)})},options:{series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(n,t){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+t.color+";'>"+n+"<br/>"+Math.round(t.percent)+"%</div>"},radius:1,background:{color:null,
opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}},name:"pie",version:"1.1"})})(jQuery);
