/*
 AGPLv2
 @author Alexandr Dubovikov <alexandr.dubovikov@gmail.com>

 Based on ocModal
 @author Olivier Combe <olivier.combe@gmail.com>
*/
(function(){var k=angular.module("homer.modal",[]);k.factory("$homerModal",["$rootScope","$controller","$location","$timeout","$compile","$sniffer","$q",function(g,q,k,h,f,b,l){var r=angular.element(document.body),u=angular.element('<div role="dialog" tabindex="-1" class="modal2"></div>'),t=angular.element('<div class="modal-wrapper"></div>'),n={},e=[],p;t.css("display","none");t.append(u);r.append(t);u.on("click",function(a){angular.element(a.target).hasClass("modal-backdrop")&&g.$apply(function(){d.closeOnEsc()});
a.stopPropagation()});var m=function(a){var c=0;a=angular.isString(a)?a.split(/\s*,\s*/):[];angular.forEach(a,function(a){c=Math.max(parseFloat(a)||0,c)});return c},w=function(a){var c=0;if(b.transitions||b.animations){var d=b.vendorPrefix+"Animation",e=b.vendorPrefix+"Transition";angular.forEach(a,function(a){if(1==a.nodeType){a=window.getComputedStyle(a)||{};var f=Math.max(m(a.transitionDelay),m(a[e+"Delay"])),b=Math.max(m(a.animationDelay),m(a[d+"Delay"])),h=Math.max(m(a.transitionDuration),m(a[e+
"Duration"])),g=Math.max(m(a.animationDuration),m(a[d+"Duration"]));0<g&&(g*=Math.max(parseInt(a.animationIterationCount)||0,parseInt(a[d+"IterationCount"])||0,1));c=Math.max(b+g,f+h,c)}})}return 1E3*c};angular.element(document).on("keyup",function(a){27==a.keyCode&&0<e.length&&(a.stopPropagation(),g.$apply(function(){d.closeOnEsc(e[e.length-1])}))});var d={waitingForOpen:!1,getOpenedModals:function(){return e},register:function(a){n[a.id||"_default"]=a},remove:function(a){delete n[a||"_default"]},
open:function(a){"string"===typeof a&&(a=a.match("<")?{template:a}:{url:a});var c=n[a.id||"_default"];if(c)if(c&&-1!==e.indexOf(a.id||"_default"))d.waitingForOpen||(d.waitingForOpen=!0,d.close(a.id).then(function(){d.open(a)}));else{if(!d.waitingForOpen)if(0===e.length)p=document.body.style.overflow,document.body.style.overflow="hidden",t.css("display","block");else for(var v=0,y=e.length;v<y;v++){var b=n[e[v]].$element;n[e[v]].baseZIndex=b.css("z-index");b.css("z-index","-1");b.addClass("no-backdrop")}d.waitingForOpen=
!1;e.push(a.id||"_default");c.params=a;c.$scope.customClass=c.params.cls;c.$scope.customId=a.id?a.id:"_default";c.$scope.divLeft=a.divLeft?a.divLeft:"100px";c.$scope.divTop=a.divTop?a.divTop:"100px";g.$digest();r[0].offsetWidth;h(function(){c.$scope.modalShow=!0},100);if("function"===typeof c.params.onOpen)c.params.onOpen();var l=c.$scope.$on("$includeContentLoaded",function(a){c.params.init&&!c.params.isolate&&angular.extend(a.targetScope,c.params.init);"string"===typeof c.params.controller&&q(c.params.controller,
{$scope:a.targetScope,$init:c.params.init,$homerModalParams:c.params});l()});if(c.params.template)c.$scope.modalTemplate=c.params.template;else if(c.params.url)c.$scope.modalUrl=c.params.url;else throw"You need to define a template or an url";"function"===typeof callback&&c.$scope.callbacksList.push(callback);if("function"===typeof c.params.onOpen)c.params.onOpen()}else u.append(f('<div homer-modal="'+(a.id?a.id:"_default")+'"></div>')(g)),h(function(){d.open(a)})},closeOnEsc:function(a){if(!1!==
n[a||e[e.length-1]].params.closeOnEsc)return d.close(a)},close:function(a){var c,v=l.defer();c="string"===typeof a&&-1!==e.indexOf(a)?Array.prototype.slice.call(arguments,1):arguments;if("undefined"===typeof a||-1===e.indexOf(a))a=e[e.length-1];var b=n[a||e[e.length-1]];if(b&&!0===b.$scope.modalShow){var f=w(angular.element(b.$element[0].querySelector(".modal-content")));h(function(){b.$scope.modalShow=!1;h(function(){b.$scope.$destroy();b.$element.remove();b.callbacksList=[];e.splice(e.indexOf(a||
e[e.length-1]),1);if(0===e.length)d.waitingForOpen||(document.body.style.overflow=p,t.css("display","none"));else{var f=n[e[e.length-1]];f.$element.css("z-index",f.baseZIndex);f.$element.removeClass("no-backdrop")}"function"===typeof b.params.onClose&&b.params.onClose.apply(void 0,c);v.resolve()},f)})}else v.resolve();return v.promise}};return d}]);k.directive("homerModal",["$homerModal","$compile","$timeout",function(g,q,k){return{restrict:"AE",replace:!0,scope:!0,template:'<div><div draggable class="modal-content {{customClass}}" ng-class="{opened: modalShow}" ng-if="modalTemplate"></div><div draggable id="{{customId}}" class="modal-content {{customClass}}" ng-class="{opened: modalShow}" ng-include="modalUrl" style="top: {{divTop}}; left: {{divLeft}}"></div></div>',
link:function(h,f,b){var l=b.homerModal,k;h.closeModal=function(){var b=Array.prototype.slice.call(arguments);b.unshift(l);g.close.apply(void 0,b)};g.register({id:l,$scope:h,$element:f});f.on("$destroy",function(){g.remove(l)});h.$watch("modalTemplate",function(b,g){"undefined"!==typeof b&&(k||(k=angular.element(f.children()[1])),k.append(q(b)(h)),h.$emit("$includeContentLoaded"))})}}}]);k.directive("homerModalOpen",["$homerModal",function(g){return{restrict:"A",require:"?modal",link:function(k,x,
h){x.on("click touchstart",function(f){f.preventDefault();f.stopPropagation();var b=k.$new().$eval(h.homerModalOpen);if(b){"number"===typeof b?b={url:h.homerModalOpen}:"string"===typeof b&&(b={url:b});if(!b.url)throw"You need to set the modal url";k.$apply(function(){g.open(b)})}})}}}])})();
(function(k,g,q){function x(d,a){for(var c in d){var b=d[c];if(!~(""+b).indexOf("-")&&r[b]!==q)return"pfx"==a?b:!0}return!1}function h(d,a,c){var b=d.charAt(0).toUpperCase()+d.slice(1),e=(d+" "+u.join(b+" ")+b).split(" ");if("string"===typeof a||"undefined"===typeof a)return x(e,a);e=(d+" "+t.join(b+" ")+b).split(" ");a:{d=e;for(var f in d)if(b=a[d[f]],b!==q){a=!1===c?d[f]:"function"===typeof b?b.bind(c||a):b;break a}a=!1}return a}var f={},b=g.documentElement,l=g.createElement("modernizr"),r=l.style,
u=["Webkit","Moz","O","ms"],t=["webkit","moz","o","ms"],l={};k=[];var n=k.slice,e,p={}.hasOwnProperty,m;m="undefined"!==typeof p&&"undefined"!==typeof p.call?function(b,a){return p.call(b,a)}:function(b,a){return a in b&&"undefined"===typeof b.constructor.prototype[a]};Function.prototype.bind||(Function.prototype.bind=function(b){var a=this;if("function"!=typeof a)throw new TypeError;var c=n.call(arguments,1),e=function(){if(this instanceof e){var f=function(){};f.prototype=a.prototype;var f=new f,
g=a.apply(f,c.concat(n.call(arguments)));return Object(g)===g?g:f}return a.apply(b,c.concat(n.call(arguments)))};return e});l.flexbox=function(){return h("flexWrap")};l.csstransforms=function(){return!!h("transform")};for(var w in l)m(l,w)&&(e=w.toLowerCase(),f[e]=l[w](),k.push((f[e]?"":"no-")+e));f.addTest=function(d,a){if("object"==typeof d)for(var c in d)m(d,c)&&f.addTest(c,d[c]);else{d=d.toLowerCase();if(f[d]!==q)return f;a="function"==typeof a?a():a;b.className+=" "+(a?"":"no-")+d;f[d]=a}return f};
r.cssText="";l=null;(function(b,a){function c(){var a=r.elements;return"string"==typeof a?a.split(" "):a}function f(a){var b=u[a[t]];b||(b={},q++,a[t]=q,u[q]=b);return b}function e(b,c,d){c||(c=a);if(p)return c.createElement(b);d||(d=f(c));c=d.cache[b]?d.cache[b].cloneNode():n.test(b)?(d.cache[b]=d.createElem(b)).cloneNode():d.createElem(b);return!c.canHaveChildren||l.test(b)||c.tagUrn?c:d.frag.appendChild(c)}function g(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,
b.frag=b.createFrag());a.createElement=function(c){return r.shivMethods?e(c,a,b):b.createElem(c)};a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+c().join().replace(/[\w\-]+/g,function(a){b.createElem(a);b.frag.createElement(a);return'c("'+a+'")'})+");return n}")(r,b.frag)}function h(b){b||(b=a);var c=f(b);if(r.shivCSS&&!m&&!c.hasCSS){var d,e=b;d=e.createElement("p");e=e.getElementsByTagName("head")[0]||e.documentElement;d.innerHTML=
"x<style>article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}</style>";d=e.insertBefore(d.lastChild,e.firstChild);c.hasCSS=!!d}p||g(b,c);return b}var k=b.html5||{},l=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,n=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,m,t="_html5shiv",q=0,u={},p;(function(){try{var b=a.createElement("a");
b.innerHTML="<xyz></xyz>";m="hidden"in b;var c;if(!(c=1==b.childNodes.length)){a.createElement("a");var d=a.createDocumentFragment();c="undefined"==typeof d.cloneNode||"undefined"==typeof d.createDocumentFragment||"undefined"==typeof d.createElement}p=c}catch(e){p=m=!0}})();var r={elements:k.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:"3.7.0",shivCSS:!1!==
k.shivCSS,supportsUnknownElements:p,shivMethods:!1!==k.shivMethods,type:"default",shivDocument:h,createElement:e,createDocumentFragment:function(b,d){b||(b=a);if(p)return b.createDocumentFragment();d=d||f(b);for(var e=d.frag.cloneNode(),g=0,h=c(),k=h.length;g<k;g++)e.createElement(h[g]);return e}};b.html5=r;h(a)})(this,g);f._version="2.8.2";f._domPrefixes=t;f._cssomPrefixes=u;f.testProp=function(b){return x([b])};f.testAllProps=h;b.className=b.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(" js "+
k.join(" "));return f})(this,this.document);
